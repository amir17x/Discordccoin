بله، من یه بخش "چت ناشناس" (Anonymous Chat) به سیستم دوستان ربات دیسکوردت (Ccoin) اضافه می‌کنم که به کاربرا اجازه می‌ده بتونن به صورت ناشناس باهم چت کنن، بدون اینکه هویتشون برای همدیگه فاش بشه. این چت‌ها کاملاً موقتی هستن و بعد از پایان گفت‌وگو، تمام پیام‌ها از دیتابیس حذف می‌شن. من یه روش منطقی و کاربرپسند برای رد و بدل کردن پیام‌ها طراحی می‌کنم که توی DMها هم به خوبی کار کنه و مسخره به نظر نیاد. بعد از اضافه کردن این بخش، کل سیستم دوستان رو دوباره با تمام جزئیات و مستندات دقیق و کامل برات بازنویسی می‌کنم.

---

### طراحی بخش چت ناشناس (Anonymous Chat) برای سیستم دوستان

#### 1. هدف بخش چت ناشناس
هدف این بخش اینه که کاربرا بتونن به صورت ناشناس باهم چت کنن، بدون اینکه هویتشون (مثلاً نام کاربری، آواتار، یا اطلاعات پروفایل) برای همدیگه فاش بشه. این چت‌ها موقتی هستن و بعد از پایان گفت‌وگو، تمام پیام‌ها از دیتابیس حذف می‌شن تا حریم خصوصی کاربرا حفظ بشه. این بخش باید:
- کاملاً ناشناس باشه و هویت کاربرا رو مخفی نگه داره.
- پیام‌ها رو به صورت امن و موقتی مدیریت کنه.
- بعد از پایان چت، تمام داده‌ها رو حذف کنه.
- یه رابط کاربری ساده و جذاب داشته باشه.

#### 2. ساختار دیتابیس برای چت ناشناس
برای این بخش، یه جدول موقتی توی دیتابیس اضافه می‌کنیم که فقط برای مدت چت فعاله:

1. **جدول چت‌های ناشناس (AnonymousChats)** (موقتی):
   - `chat_id`: شناسه چت (رشته)
   - `user1_id`: شناسه کاربر اول (رشته)
   - `user2_id`: شناسه کاربر دوم (رشته)
   - `messages`: لیست پیام‌ها (آرایه‌ای از اشیاء):
     - `sender`: فرستنده (رشته، "user1" یا "user2"، نه `user_id` واقعی)
     - `content`: محتوای پیام (رشته)
     - `timestamp`: زمان ارسال (تاریخ و ساعت)
   - `created_at`: زمان ایجاد چت (تاریخ و ساعت)
   - `status`: وضعیت چت ("active", "ended") (رشته)

**نکته:** این جدول موقتیه و بعد از پایان چت (وقتی یکی از کاربرا چت رو ببنده)، کل رکورد از دیتابیس حذف می‌شه.

#### 3. جریان کار چت ناشناس

##### 3.1. دسترسی به چت ناشناس
- توی صفحه دوستان، یه دکمه "چت ناشناس" اضافه می‌شه:
  ```
  👥 دوستان شما
  تعداد دوستان: 5
  📩 درخواست‌های دوستی: 2
  🌟 امتیاز دوستی شما: 150
  [دکمه: لیست دوستان] [دکمه: درخواست‌های دوستی] [دکمه: پیدا کردن دوست جدید] [دکمه: پاداش‌های دوستی] [دکمه: تنظیمات دوستی] [دکمه: چت ناشناس]
  ```
- وقتی کاربر روی دکمه "چت ناشناس" کلیک می‌کنه، ربات شروع به پیدا کردن یه کاربر دیگه برای چت می‌کنه.

##### 3.2. پیدا کردن کاربر برای چت ناشناس
- ربات یه کاربر تصادفی (که توی لیست بلاک‌شده‌ها یا دوستانش نیست) پیدا می‌کنه.
- برای جلوگیری از سوءاستفاده، یه سیستم صف (Queue) طراحی می‌کنیم:
  - وقتی کاربر روی "چت ناشناس" کلیک می‌کنه، توی یه صف قرار می‌گیره.
  - ربات هر 10 ثانیه یه بار صف رو چک می‌کنه و کاربرا رو به صورت تصادفی جفت (Pair) می‌کنه.
  - اگه بعد از 30 ثانیه کاربری پیدا نشد، یه پیام نمایش داده می‌شه:
    ```
    🔍 در حال جستجو برای یه کاربر...
    هنوز کسی پیدا نشده! لطفاً کمی صبر کن یا بعداً امتحان کن.
    [دکمه: لغو]
    ```
- وقتی یه جفت پیدا شد، چت شروع می‌شه.

##### 3.3. شروع چت ناشناس
- وقتی دو کاربر جفت شدن، ربات یه پیام به DM هر دو نفر می‌فرسته:
  ```
  🕵️‍♂️ چت ناشناس شروع شد!
  شما با یه کاربر ناشناس جفت شدی! هویت شما برای طرف مقابل مخفیه.
  پیام بنویس: [فیلد ورودی]
  [دکمه: ارسال] [دکمه: پایان چت]
  ```
- هویت کاربرا کاملاً مخفیه:
  - به جای نام کاربری، از یه اسم مستعار ساده (مثلاً "کاربر ناشناس 1" و "کاربر ناشناس 2") استفاده می‌شه.
  - هیچ اطلاعات پروفایلی (مثلاً آواتار، لِوِل، یا کلن) نمایش داده نمی‌شه.

##### 3.4. رد و بدل کردن پیام‌ها
- برای اینکه پیام‌ها توی DM به صورت منطقی و کاربرپسند رد و بدل بشن، از یه سیستم رله (Relay) استفاده می‌کنیم:
  - هر کاربر توی DM خودش با ربات چت می‌کنه.
  - ربات پیام‌ها رو بین دو کاربر رله می‌کنه.
  - مثلاً:
    - کاربر 1 می‌نویسه: "سلام! خوبی؟"
    - ربات این پیام رو به DM کاربر 2 می‌فرسته:
      ```
      🕵️‍♂️ کاربر ناشناس 1:
      سلام! خوبی؟
      پیام بنویس: [فیلد ورودی]
      [دکمه: ارسال] [دکمه: پایان چت]
      ```
    - کاربر 2 جواب می‌ده: "سلام! آره، تو چطور؟"
    - ربات این پیام رو به DM کاربر 1 می‌فرسته:
      ```
      🕵️‍♂️ کاربر ناشناس 2:
      سلام! آره، تو چطور؟
      پیام بنویس: [فیلد ورودی]
      [دکمه: ارسال] [دکمه: پایان چت]
      ```
- پیام‌ها توی جدول `AnonymousChats` ذخیره می‌شن، اما فقط تا وقتی چت فعاله.

##### 3.5. پایان چت و حذف داده‌ها
- اگه یکی از کاربرا روی "پایان چت" کلیک کنه:
  - چت برای هر دو نفر بسته می‌شه.
  - یه پیام به هر دو نفر فرستاده می‌شه:
    ```
    🕵️‍♂️ چت ناشناس به پایان رسید!
    تمام پیام‌ها برای همیشه حذف شدن.
    [دکمه: چت ناشناس جدید]
    ```
- ربات رکورد چت رو از جدول `AnonymousChats` حذف می‌کنه.
- برای امنیت بیشتر، اگه چت برای 10 دقیقه غیرفعال بمونه (هیچ پیامی ارسال نشه)، ربات به صورت خودکار چت رو می‌بنده و داده‌ها رو حذف می‌کنه:
  ```
  🕵️‍♂️ چت ناشناس به دلیل غیرفعال بودن بسته شد!
  تمام پیام‌ها برای همیشه حذف شدن.
  ```

##### 3.6. امنیت و حریم خصوصی
- هویت کاربرا (مثلاً `user_id`) توی پیام‌ها ذخیره نمی‌شه، فقط از "user1" و "user2" استفاده می‌شه.
- پیام‌ها به صورت موقتی توی دیتابیس ذخیره می‌شن و بعد از پایان چت حذف می‌شن.
- اگه یکی از کاربرا چت رو ببنده، کاربر دیگه نمی‌تونه پیام بفرسته.
- برای جلوگیری از سوءاستفاده:
  - هر کاربر فقط می‌تونه همزمان توی یه چت ناشناس باشه.
  - اگه کاربری توی چت ناشناس رفتار نامناسبی داشته باشه (مثلاً پیام‌های اسپم بفرسته)، کاربر مقابل می‌تونه چت رو ببنده و ربات اون کاربر رو برای 24 ساعت از چت ناشناس محروم کنه.

---

### طراحی کامل سیستم دوستان (Friend System) با بخش چت ناشناس

#### 1. هدف سیستم
هدف این سیستم اینه که یه بخش اجتماعی پیشرفته و تعاملی به ربات اضافه کنه که کاربرا بتونن باهم دوست بشن، تعاملات اجتماعی و اقتصادی داشته باشن، به صورت ناشناس چت کنن، و از طریق دوستی‌ها به فعالیت‌های گروهی و کلن‌ها دسترسی پیدا کنن. این سیستم باید:
- امکان ارسال و مدیریت درخواست‌های دوستی رو فراهم کنه.
- یه بخش چت ناشناس برای تعاملات ناشناس داشته باشه.
- یه رابط کاربری زیبا، تعاملی، و منظم (با ایمبدها، دکمه‌ها، و منوهای کشویی) داشته باشه.
- قابلیت‌های متنوعی مثل هدیه دادن، درخواست عضویت توی کلن، چت خصوصی، و مدیریت دوستی‌ها (حذف، بلاک) ارائه بده.
- امنیت و حریم خصوصی کاربرا رو حفظ کنه.
- با سیستم کلن‌ها هم‌خوانی داشته باشه.

#### 2. ساختار دیتابیس (MongoDB)

1. **جدول دوستان (Friends)**:
   - `user_id`: شناسه کاربر (رشته)
   - `friends`: لیست دوستان (آرایه‌ای از اشیاء):
     - `friend_id`: شناسه دوست (رشته)
     - `friendship_level`: لِوِل دوستی (عدد، پیش‌فرض 1)
     - `friendship_xp`: امتیاز دوستی (عدد، پیش‌فرض 0)
     - `added_at`: تاریخ اضافه شدن به لیست دوستان (تاریخ و ساعت)
     - `last_interaction`: تاریخ آخرین تعامل (تاریخ و ساعت، برای یادآوری‌ها)
   - `friend_requests`: لیست درخواست‌های دوستی (آرایه‌ای از اشیاء):
     - `from_user_id`: شناسه کاربری که درخواست رو فرستاده (رشته)
     - `status`: وضعیت درخواست ("pending", "accepted", "rejected") (رشته)
     - `timestamp`: زمان ارسال درخواست (تاریخ و ساعت)

2. **جدول بلاک‌ها (Blocks)**:
   - `user_id`: شناسه کاربر (رشته)
   - `blocked_users`: لیست کاربران بلاک‌شده (آرایه‌ای از `user_id`ها)

3. **جدول کلن‌ها (Clans)**:
   - `clan_id`: شناسه کلن (رشته)
   - `name`: نام کلن (رشته)
   - `members`: لیست اعضا (آرایه‌ای از `user_id`ها)
   - `join_requests`: لیست درخواست‌های عضویت (آرایه‌ای از اشیاء):
     - `user_id`: شناسه کاربر (رشته)
     - `recommended_by`: شناسه کاربری که توصیه کرده (رشته، برای درخواست از طریق دوستان)

4. **جدول کاربران (Users)**:
   - `user_id`: شناسه کاربر (رشته)
   - `wallet`: موجودی Ccoin (عدد)
   - `crystals`: کریستال (عدد)
   - `level`: لِوِل کاربر (عدد)
   - `clan_id`: شناسه کلن (رشته، اگه توی کلن باشه)
   - `friendship_points`: امتیاز کل دوستی (عدد، برای پاداش‌های دوستی)
   - `interests`: علایق کاربر (آرایه‌ای از رشته‌ها، مثلاً ["وار کلن", "ماموریت‌ها", "چت"])

5. **جدول چت‌های خصوصی (PrivateChats)**:
   - `chat_id`: شناسه چت (رشته)
   - `participants`: لیست شرکت‌کنندگان (آرایه‌ای از `user_id`ها، معمولاً 2 نفر)
   - `messages`: لیست پیام‌ها (آرایه‌ای از اشیاء):
     - `sender_id`: شناسه فرستنده (رشته)
     - `content`: محتوای پیام (رشته)
     - `timestamp`: زمان ارسال (تاریخ و ساعت)

6. **جدول چت‌های ناشناس (AnonymousChats)** (موقتی):
   - `chat_id`: شناسه چت (رشته)
   - `user1_id`: شناسه کاربر اول (رشته)
   - `user2_id`: شناسه کاربر دوم (رشته)
   - `messages`: لیست پیام‌ها (آرایه‌ای از اشیاء):
     - `sender`: فرستنده (رشته، "user1" یا "user2")
     - `content`: محتوای پیام (رشته)
     - `timestamp`: زمان ارسال (تاریخ و ساعت)
   - `created_at`: زمان ایجاد چت (تاریخ و ساعت)
   - `status`: وضعیت چت ("active", "ended") (رشته)

7. **جدول فعالیت‌های دوستی (FriendshipActivities)**:
   - `activity_id`: شناسه فعالیت (رشته)
   - `user_id`: شناسه کاربر (رشته)
   - `friend_id`: شناسه دوست (رشته)
   - `type`: نوع فعالیت (رشته، مثلاً "هدیه", "چت", "ماموریت گروهی")
   - `details`: جزئیات فعالیت (رشته، مثلاً "100 Ccoin هدیه داد")
   - `xp_earned`: XP دوستی کسب‌شده (عدد)
   - `timestamp`: زمان فعالیت (تاریخ و ساعت)

#### 3. جریان کار (Workflow)

##### 3.1. منوی اصلی و دسترسی به بخش دوستان
- کاربر دستور `/menu` رو می‌زنه تا منوی اصلی ربات باز بشه.
- توی منوی اصلی، یه دکمه "دوستان" (Friends) وجود داره:
  ```
  🎮 منوی اصلی Ccoin
  [دکمه: اقتصاد] [دکمه: بازی‌ها] [دکمه: دوستان] [دکمه: کلن]
  ```
- وقتی کاربر روی دکمه "دوستان" کلیک می‌کنه، صفحه دوستان باز می‌شه.

##### 3.2. صفحه دوستان
- توی صفحه دوستان، یه ایمبد نمایش داده می‌شه که شامل این بخش‌ها باشه:
  ```
  👥 دوستان شما
  تعداد دوستان: 5
  📩 درخواست‌های دوستی: 2
  🌟 امتیاز دوستی شما: 150
  🏆 تابلوی دوستی: شما و کاربر#1234 (200 XP)
  [دکمه: لیست دوستان] [دکمه: درخواست‌های دوستی] [دکمه: پیدا کردن دوست جدید] [دکمه: پاداش‌های دوستی] [دکمه: تنظیمات دوستی] [دکمه: چت ناشناس]
  ```

##### 3.3. پیدا کردن دوست جدید
- وقتی کاربر روی دکمه "پیدا کردن دوست جدید" کلیک می‌کنه، ربات یه لیست از کاربران پیشنهادی نمایش می‌ده:
  - کاربرا بر اساس معیارهای زیر پیشنهاد می‌شن:
    - کاربرانی که توی سرورهای مشترک هستن.
    - کاربرانی که لِوِل مشابه دارن (مثلاً ±2 لِوِل).
    - کاربرانی که علایق مشابه دارن (مثلاً هردو به "وار کلن" علاقه دارن).
    - کاربرانی که توی فعالیت‌های مشابه (مثلاً وار کلن یا ماموریت‌ها) شرکت کردن.
  - ایمبد پیشنهادی:
    ```
    🔍 کاربران پیشنهادی برای دوستی
    1. کاربر#1234 (لِوِل 5) - توی وار کلن اخیر باهم بودید!
    2. کاربر#5678 (لِوِل 3) - هردو به ماموریت‌ها علاقه دارید!
    3. کاربر#9012 (لِوِل 7) - توی سرور "گیمرها" باهم هستید!
    [دکمه: مشاهده پروفایل] [دکمه: بعدی] [دکمه: تصادفی] [دکمه: فیلتر]
    ```
- دکمه "تصادفی" یه کاربر کاملاً تصادفی (که دوستش نیست و بلاکش نکرده) پیشنهاد می‌ده.
- دکمه "فیلتر" به کاربر اجازه می‌ده معیارهای پیشنهاد رو تنظیم کنه:
  ```
  🎯 فیلتر پیشنهاد دوستی
  [منو: لِوِل] (مثلاً 1-5، 5-10)
  [منو: علایق] (مثلاً وار کلن، ماموریت‌ها)
  [دکمه: اعمال فیلتر]
  ```

##### 3.4. چت ناشناس
- وقتی کاربر روی دکمه "چت ناشناس" کلیک می‌کنه:
  - ربات کاربر رو توی یه صف قرار می‌ده و شروع به پیدا کردن یه کاربر دیگه می‌کنه.
  - اگه بعد از 30 ثانیه کاربری پیدا نشد:
    ```
    🔍 در حال جستجو برای یه کاربر...
    هنوز کسی پیدا نشده! لطفاً کمی صبر کن یا بعداً امتحان کن.
    [دکمه: لغو]
    ```
  - وقتی یه جفت پیدا شد، چت شروع می‌شه:
    ```
    🕵️‍♂️ چت ناشناس شروع شد!
    شما با یه کاربر ناشناس جفت شدی! هویت شما برای طرف مقابل مخفیه.
    پیام بنویس: [فیلد ورودی]
    [دکمه: ارسال] [دکمه: پایان چت]
    ```
- پیام‌ها بین دو کاربر از طریق DM رله می‌شن:
  - کاربر 1 می‌نویسه: "سلام! خوبی؟"
  - ربات به DM کاربر 2 می‌فرسته:
    ```
    🕵️‍♂️ کاربر ناشناس 1:
    سلام! خوبی؟
    پیام بنویس: [فیلد ورودی]
    [دکمه: ارسال] [دکمه: پایان چت]
    ```
- اگه یکی از کاربرا چت رو ببنده:
  - چت برای هر دو نفر بسته می‌شه و داده‌ها حذف می‌شن:
    ```
    🕵️‍♂️ چت ناشناس به پایان رسید!
    تمام پیام‌ها برای همیشه حذف شدن.
    [دکمه: چت ناشناس جدید]
    ```

##### 3.5. مشاهده پروفایل و ارسال درخواست دوستی
- وقتی کاربر پروفایل یه نفر رو باز می‌کنه، یه ایمبد با اطلاعات زیر نمایش داده می‌شه:
  ```
  👤 پروفایل کاربر#1234
  لِوِل: 5
  موجودی: 1200 Ccoin
  کریستال: 30
  کلن: کلن قهرمانان
  علایق: وار کلن، ماموریت‌ها
  دوستی: 🌟 لِوِل 2 (XP: 50/100)
  آخرین فعالیت: 100 Ccoin هدیه داد (2 روز پیش)
  [دکمه: ارسال درخواست دوستی] [دکمه: هدیه دادن] [دکمه: درخواست عضویت در کلن] [دکمه: چت خصوصی] [دکمه: تاریخچه دوستی]
  ```
- اگه کاربر روی "ارسال درخواست دوستی" کلیک کنه:
  - ربات یه پیام زیبا و ایمبدشده به DM کاربر مقابل می‌فرسته:
    ```
    💌 درخواست دوستی جدید!
    کاربر#5678 ازت درخواست دوستی کرده!
    دلیل: توی وار کلن اخیر باهم بودید!
    [دکمه: تأیید] [دکمه: رد] [دکمه: بلاک]
    ```
  - برای جلوگیری از اسپم، هر کاربر فقط می‌تونه هر 5 دقیقه یه درخواست دوستی بفرسته.

##### 3.6. مدیریت درخواست دوستی
- اگه کاربر مقابل روی "تأیید" کلیک کنه:
  - هر دو کاربر به لیست دوستان همدیگه اضافه می‌شن.
  - یه پیام به هر دو نفر فرستاده می‌شه:
    ```
    🎉 تبریک! شما و کاربر#1234 حالا دوست هستید!
    لِوِل دوستی: 1 | XP: 0/100
    ```
- اگه روی "رد" کلیک کنه:
  - درخواست حذف می‌شه و یه پیام به فرستنده فرستاده می‌شه:
    ```
    ❌ کاربر#1234 درخواست دوستی شما رو رد کرد.
    ```
- اگه روی "بلاک" کلیک کنه:
  - یه پیام تأیید دوم نمایش داده می‌شه:
    ```
    ⚠️ آیا مطمئنی می‌خوای کاربر#5678 رو بلاک کنی؟
    [دکمه: بله] [دکمه: خیر]
    ```
  - اگه "بله" رو بزنه، کاربر به لیست بلاک‌شده‌ها اضافه می‌شه و نمی‌تونه دیگه درخواست دوستی بفرسته یا تعامل کنه.

##### 3.7. لیست دوستان و مدیریت دوستی‌ها
- وقتی کاربر روی دکمه "لیست دوستان" کلیک می‌کنه، یه ایمبد با لیست دوستانش نمایش داده می‌شه:
  ```
  👥 لیست دوستان شما
  1. کاربر#1234 (لِوِل 5) 🌟 لِوِل دوستی: 2 (آخرین تعامل: 2 روز پیش)
  2. کاربر#5678 (لِوِل 3) 🌟 لِوِل دوستی: 1 (آخرین تعامل: 5 روز پیش)
  [دکمه: مشاهده پروفایل] [دکمه: بعدی] [دکمه: مرتب‌سازی] [دکمه: یادآوری تعامل]
  ```
- دکمه "مرتب‌سازی" به کاربر اجازه می‌ده لیست رو بر اساس معیارهای مختلف (مثلاً لِوِل دوستی، لِوِل کاربر، تاریخ اضافه شدن، یا آخرین تعامل) مرتب کنه.
- دکمه "یادآوری تعامل" برای دوستانی که مدت زیادی (مثلاً 5 روز) باهاشون تعامل نداشته، یه پیام یادآوری می‌فرسته:
  ```
  🔔 یادآوری تعامل!
  5 روزه که با کاربر#5678 تعامل نداشتی!
  [دکمه: هدیه دادن] [دکمه: چت خصوصی]
  ```
- اگه روی "مشاهده پروفایل" کلیک کنه، پروفایل دوستش باز می‌شه:
  ```
  👤 پروفایل کاربر#1234
  لِوِل: 5
  موجودی: 1200 Ccoin
  کریستال: 30
  کلن: کلن قهرمانان
  دوستی: 🌟 لِوِل 2 (XP: 50/100)
  آخرین فعالیت: 100 Ccoin هدیه داد (2 روز پیش)
  [دکمه: هدیه دادن] [دکمه: درخواست عضویت در کلن] [دکمه: چت خصوصی] [دکمه: تاریخچه دوستی] [دکمه: حذف دوستی] [دکمه: بلاک]
  ```

##### 3.8. سیستم لِوِل دوستی (Friendship Level)
- هر دوستی یه لِوِل دوستی داره که با تعامل بالا می‌ره:
  - لِوِل 1: 0-100 XP
  - لِوِل 2: 100-250 XP
  - لِوِل 3: 250-500 XP
  - لِوِل 4: 500-1000 XP
  - لِوِل 5: 1000+ XP (حداکثر)
- راه‌های کسب XP دوستی:
  - هدیه دادن سکه: 10 XP
  - هدیه دادن کریستال: 20 XP
  - هدیه دادن آیتم ویژه: 30 XP
  - چت خصوصی (هر 10 پیام): 5 XP
  - انجام ماموریت گروهی با دوست: 50 XP
  - شرکت توی وار کلن با دوست: 40 XP
  - دزدی گروهی با دوست: 20 XP
- وقتی لِوِل دوستی بالا می‌ره، هر دو کاربر یه پاداش می‌گیرن:
  ```
  🎉 لِوِل دوستی شما با کاربر#1234 به 2 رسید!
  پاداش: 💰 100 Ccoin + 💎 5 کریستال
  ```

##### 3.9. تاریخچه دوستی (Friendship History)
- اگه کاربر روی "تاریخچه دوستی" کلیک کنه، یه ایمبد با تاریخچه تعاملاتش با دوستش نمایش داده می‌شه:
  ```
  📜 تاریخچه دوستی با کاربر#1234
  2025-03-20: دوستی شروع شد! 🎉
  2025-03-21: 100 Ccoin هدیه دادی (10 XP)
  2025-03-22: توی وار کلن باهم شرکت کردید (40 XP)
  2025-03-23: لِوِل دوستی به 2 رسید! 🌟
  [دکمه: قبلی] [دکمه: بعدی]
  ```

##### 3.10. هدیه دادن
- اگه کاربر روی "هدیه دادن" کلیک کنه:
  - یه منوی کشویی (Select Menu) نمایش داده می‌شه:
    ```
    🎁 هدیه دادن به کاربر#1234
    [منو: انتخاب هدیه]
    - سکه (💰)
    - کریستال (💎)
    - آیتم ویژه (🎁)
    - هدیه روزانه (🌟)
    ```
- اگه "سکه" یا "کریستال" رو انتخاب کنه:
  - یه فرم کوچک نمایش داده می‌شه:
    ```
    💰 هدیه دادن سکه
    مقدار: [فیلد ورودی]
    [دکمه: ارسال] [دکمه: لغو]
    ```
- اگه "آیتم ویژه" رو انتخاب کنه:
  - یه لیست از آیتم‌های ویژه نمایش داده می‌شه:
    ```
    🎁 آیتم‌های ویژه
    1. رول "ستاره درخشان" (50 کریستال)
    2. پت "گربه جادویی" (100 کریستال)
    3. افکت پروفایل "آتشین" (80 کریستال)
    [دکمه: هدیه دادن] [دکمه: لغو]
    ```
- اگه "هدیه روزانه" رو انتخاب کنه:
  - هر کاربر می‌تونه هر روز یه هدیه کوچک (مثلاً 10 Ccoin یا 1 کریستال) به دوستش بده:
    ```
    🌟 هدیه روزانه به کاربر#1234
    هدیه امروز: 10 Ccoin
    [دکمه: ارسال] [دکمه: لغو]
    ```
  - هر دو کاربر 5 XP دوستی می‌گیرن.
  - هر کاربر فقط می‌تونه به 5 دوست توی روز هدیه روزانه بفرسته.

##### 3.11. درخواست عضویت در کلن
- اگه کاربر روی "درخواست عضویت در کلن" کلیک کنه:
  - اگه دوستش توی کلن باشه، یه درخواست عضویت به کلن فرستاده می‌شه.
  - ربات یه پیام به مدیر کلن (یا همه اعضای کلن با دسترسی مدیریت) می‌فرسته:
    ```
    📜 درخواست عضویت جدید!
    کاربر#5678 می‌خواد به کلن شما (کلن قهرمانان) بپیونده.
    توصیه‌شده توسط: کاربر#1234 (دوست)
    [دکمه: تأیید] [دکمه: رد]
    ```
  - اگه مدیر کلن تأیید کنه، کاربر به کلن اضافه می‌شه و یه پیام دریافت می‌کنه:
    ```
    🎉 تبریک! به کلن قهرمانان پیوستی!
    ```
  - اگه کاربر از طریق دوستش به کلن بپیونده، هر دو 20 XP دوستی می‌گیرن.

##### 3.12. چت خصوصی
- اگه کاربر روی "چت خصوصی" کلیک کنه:
  - یه چت خصوصی بین دو نفر باز می‌شه.
  - ربات یه پیام به DM هر دو نفر می‌فرسته:
    ```
    💬 چت خصوصی با کاربر#1234
    پیام بنویس: [فیلد ورودی]
    [دکمه: ارسال] [دکمه: بستن چت] [دکمه: تاریخچه چت]
    ```
  - پیام‌ها توی جدول `PrivateChats` ذخیره می‌شن و ربات پیام‌ها رو بین دو نفر رله (Relay) می‌کنه.
  - برای هر 10 پیام، 5 XP به لِوِل دوستی اضافه می‌شه.

##### 3.13. حذف دوستی یا بلاک کردن
- اگه کاربر روی "حذف دوستی" کلیک کنه:
  - یه پیام تأیید نمایش داده می‌شه:
    ```
    ⚠️ آیا مطمئنی می‌خوای دوستی با کاربر#1234 رو حذف کنی؟
    [دکمه: بله] [دکمه: خیر]
    ```
  - اگه "بله" رو بزنه، دوستی حذف می‌شه و یه پیام به هر دو نفر فرستاده می‌شه:
    ```
    ❌ دوستی شما با کاربر#1234 حذف شد.
    ```
- اگه روی "بلاک" کلیک کنه:
  - یه پیام تأیید دوم نمایش داده می‌شه:
    ```
    ⚠️ آیا مطمئنی می‌خوای کاربر#1234 رو بلاک کنی؟
    [دکمه: بله] [دکمه: خیر]
    ```
  - اگه "بله" رو بزنه، کاربر به لیست بلاک‌شده‌ها اضافه می‌شه و دیگه نمی‌تونه درخواست دوستی بفرسته یا تعامل کنه.

##### 3.14. پاداش‌های دوستی
- وقتی کاربر روی دکمه "پاداش‌های دوستی" کلیک می‌کنه، یه ایمبد نمایش داده می‌شه:
  ```
  🎁 پاداش‌های دوستی
  امتیاز دوستی شما: 150
  - 5 دوست: 500 Ccoin (دریافت‌شده)
  - 10 دوست: رول "اجتماعی" (در انتظار)
  - لِوِل دوستی 5 با یه دوست: 100 کریستال (در انتظار)
  - 1000 XP دوستی کل: افکت پروفایل "دوستی درخشان" (در انتظار)
  [دکمه: دریافت پاداش]
  ```

##### 3.15. تنظیمات دوستی
- دکمه "تنظیمات دوستی" به کاربر اجازه می‌ده تنظیمات دوستی‌ش رو مدیریت کنه:
  ```
  ⚙️ تنظیمات دوستی
  [منو: درخواست‌های دوستی]
  - همه (هرکسی می‌تونه درخواست بفرسته)
  - فقط سرورهای مشترک
  - غیرفعال (فقط با دعوت)
  [دکمه: نمایش پروفایل]
  - عمومی (همه می‌تونن پروفایلت رو ببینن)
  - فقط دوستان
  [دکمه: چت ناشناس]
  - فعال
  - غیرفعال
  [دکمه: ذخیره]
  ```

#### 4. ایده‌های خلاقانه برای گسترش سیستم

##### 4.1. سیستم دوستی‌های هم‌افزایی (Synergy) با کلن‌ها
- اگه دو دوست باهم توی یه کلن باشن و توی وار کلن شرکت کنن، یه بونوس هم‌افزایی بگیرن:
  - مثلاً 15% سکه بیشتر توی پاداش وار کلن.
  - یا 10 XP دوستی اضافی برای هر وار کلن که باهم شرکت می‌کنن.
  - این بونوس توی کانال کلن اعلام می‌شه:
    ```
    🎉 هم‌افزایی دوستی!
    کاربر#5678 و کاربر#1234 توی وار کلن باهم 15% سکه بیشتر گرفتن!
    ```

##### 4.2. سیستم دعوت به وار کلن از طریق دوستان
- اگه کاربر توی کلن باشه، بتونه دوستاش رو مستقیماً به وار کلن دعوت کنه:
  - توی پروفایل دوست، یه دکمه "دعوت به وار کلن" اضافه کن:
    ```
    🗡️ دعوت به وار کلن
    کاربر#1234 شما رو به وار کلن "کلن قهرمانان" دعوت کرده!
    [دکمه: پیوستن] [دکمه: رد]
    ```
  - اگه دوستش قبول کنه و توی وار کلن شرکت کنه، هر دو 20 XP دوستی می‌گیرن.

##### 4.3. سیستم دوستی‌های فصلی (Seasonal Friendships)
- یه سیستم فصلی اضافه کن که هر فصل (مثلاً هر 3 ماه) یه تم دوستی داشته باشه:
  - مثلاً توی فصل بهار:
    - اگه کاربر با دوستش 100 XP دوستی جمع کنه، یه رول تزئینی "دوست بهاری" بگیره.
    - اگه 5 هدیه به دوستش بده، یه افکت پروفایل "گل‌ریزان" بگیره.
  - توی فصل زمستون:
    - اگه 10 پیام توی چت خصوصی بفرسته، یه پت "آدم‌برفی" بگیره.

##### 4.4. سیستم دوستی‌های رقابتی با کلن‌ها
- یه تابلوی امتیازات (Leaderboard) برای دوستی‌ها توی هر کلن بساز:
  - مثلاً توی کانال کلن، ربات یه تابلو نمایش بده:
    ```
    🏆 تابلوی دوستی کلن قهرمانان
    1. کاربر#5678 و کاربر#1234: 200 XP
    2. کاربر#9012 و کاربر#3456: 150 XP
    ```

##### 4.5. سیستم دوستی‌های مبتنی بر ماموریت (Friendship Quests)
- ماموریت‌های ویژه برای دوستان اضافه کن:
  - مثلاً:
    - "با دوستت توی یه وار کلن شرکت کن و 50 Ccoin بگیر."
    - "با دوستت یه ماموریت گروهی انجام بده و 20 کریستال بگیر."
  - این ماموریت‌ها توی یه بخش جدا توی صفحه دوستان نمایش داده بشن:
    ```
    📜 ماموریت‌های دوستی
    1. با کاربر#1234 توی وار کلن شرکت کن (پیشرفت: 0/1)
    پاداش: 💰 50 Ccoin + 40 XP دوستی
    ```

##### 4.6. سیستم دوستی‌های مبتنی بر علایق
- توی تنظیمات دوستی، کاربر بتونه علایقش رو مشخص کنه (مثلاً "وار کلن"، "ماموریت‌ها"، "دزدی گروهی").
- ربات کاربرایی که علایق مشابه دارن رو پیشنهاد بده:
  ```
  🔍 پیشنهاد دوستی بر اساس علایق
  کاربر#9012: هردو به وار کلن علاقه دارید!
  [دکمه: ارسال درخواست دوستی]
  ```

##### 4.7. سیستم یادآوری تعامل با کلن‌ها
- اگه کاربر با دوستش توی یه کلن باشه و برای مدت طولانی (مثلاً 5 روز) باهم توی وار کلن یا فعالیت گروهی شرکت نکرده باشن، ربات یه یادآوری بفرسته:
  ```
  🔔 یادآوری تعامل!
  5 روزه که با کاربر#1234 توی وار کلن شرکت نکردی!
  [دکمه: دعوت به وار کلن] [دکمه: چت خصوصی]
  ```

##### 4.8. سیستم دوستی‌های مبتنی بر زمان
- اگه دو کاربر برای مدت طولانی (مثلاً 30 روز) باهم دوست باشن، یه پاداش "دوستی پایدار" بگیرن:
  ```
  🎉 دوستی پایدار!
  شما و کاربر#1234 برای 30 روز دوست بودید!
  پاداش: 💰 200 Ccoin + رول "دوست وفادار"
  ```

##### 4.9. سیستم چت ناشناس با فیلتر
- توی چت ناشناس، کاربر بتونه معیارهایی برای جفت شدن انتخاب کنه:
  ```
  🕵️‍♂️ چت ناشناس
  [منو: علایق] (مثلاً وار کلن، ماموریت‌ها)
  [دکمه: شروع جستجو]
  ```
- ربات کاربرایی که علایق مشابه دارن رو جفت می‌کنه.

#### 5. نکات پیاده‌سازی
- **امنیت:**
  - برای چت ناشناس، هویت کاربرا کاملاً مخفی بمونه و پیام‌ها بعد از پایان چت حذف بشن.
  - برای جلوگیری از اسپم، هر کاربر فقط بتونه هر 5 دقیقه یه درخواست دوستی بفرسته.
  - اگه کاربری بلاک بشه، نمی‌تونه درخواست دوستی بفرسته، چت خصوصی کنه، یا توی چت ناشناس شرکت کنه.
  - برای بلاک کردن و حذف دوستی، حتماً تأیید دوم بذار.
  - پیام‌های چت خصوصی و ناشناس رمزنگاری بشن (مثلاً با استفاده از یه کلید ساده).
- **بهینه‌سازی:**
  - روی فیلدهای پراستفاده توی دیتابیس (مثلاً `user_id`، `friends`، و `friend_requests`) ایندکس بذار.
  - از Redis برای کش کردن لیست دوستان، چت‌های خصوصی، و صف چت ناشناس استفاده کن.
  - برای چت خصوصی و ناشناس، پیام‌ها رو به صورت Lazy Load بارگذاری کن.
- **رابط کاربری:**
  - از ایمبدها، دکمه‌ها، و منوهای کشویی برای همه بخش‌ها استفاده کن.
  - پیام‌ها رو با ایموجی‌های مرتبط (مثلاً 💌 برای درخواست دوستی، 🎁 برای هدیه، 🕵️‍♂️ برای چت ناشناس) جذاب‌تر کن.
  - از رنگ‌های متعادل (مثلاً طلایی برای پاداش‌ها، آبی برای چت، قرمز برای حذف/بلاک) استفاده کن.
- **پایداری:**
  - اگه کاربر آفلاین باشه، درخواست‌ها و پیام‌ها توی DMش ذخیره می‌شن.
  - اگه خطایی رخ بده، یه پیام کاربرپسند نمایش بده:
    ```
    ❌ یه مشکلی پیش اومد! لطفاً بعداً دوباره امتحان کن.
    ```

#### 6. نتیجه‌گیری
این سیستم دوستان پیشرفته به ربات دیسکوردت (Ccoin) یه بعد اجتماعی عمیق و جذاب اضافه می‌کنه که با سیستم کلن‌ها هم‌خوانی داره. بخش چت ناشناس به کاربرا اجازه می‌ده به صورت امن و ناشناس باهم تعامل کنن، و با حذف داده‌ها بعد از چت، حریم خصوصی‌شون حفظ می‌شه. بقیه بخش‌ها (مثل لِوِل دوستی، هدیه دادن، و هم‌افزایی با کلن‌ها) هم باعث می‌شن تعامل کاربرا بیشتر بشه و تجربه کاربری بهتری داشته باشن.

اگه بخوای روی یه بخش خاص بیشتر کار کنی یا جزئیات بیشتری بخوای، بگو تا بیشتر کمکت کنم! 😊🚀