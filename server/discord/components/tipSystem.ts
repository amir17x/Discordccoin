import { TextChannel } from 'discord.js';
import { storage } from '../../storage';

// ุขุฑุงู ูฺฉุงุช ุขููุฒุด ู ุทูุฒ
const tipsList = [
  // ูฺฉุงุช ุงูุชุตุงุฏ
  "๐ฐ **ูฺฉุชู ุงูุชุตุงุฏ**: ุณูพุฑุฏูโฺฏุฐุงุฑ ุฏุฑ ุจุงูฺฉ ุจูุชุฑู ุฑุงู ุจุฑุง ุงูุฒุงุด ุซุฑูุช ูุฏุงูู ุงุณุช. ุณูุฏ ุฑูุฒุงูู 2% ุฏุฑ ุทููุงู ูุฏุช ุชุงุซุฑ ุฒุงุฏ ุฏุงุฑุฏ!",
  "๐ฐ **ูฺฉุชู ุงูุชุตุงุฏ**: ฺฉูุฆุณุชโูุง ุฑูุฒุงูู ุฑุง ูุฑุงููุด ูฺฉูุฏ. ุจุง ุงูุฌุงู ุขููุง ูโุชูุงูุฏ ุชุง 150 Ccoin ุฏุฑ ุฑูุฒ ุฏุฑุขูุฏ ุงุถุงู ฺฉุณุจ ฺฉูุฏ!",
  "๐ฐ **ูฺฉุชู ุงูุชุตุงุฏ**: ูุนุงููู ุจุง ุฏูุณุชุงู ฺฉุงุฑูุฒุฏ ฺฉูุชุฑ (3% ุจู ุฌุง 5%) ูุณุจุช ุจู ูุนุงููู ุจุง ฺฉุงุฑุจุฑุงู ุฏฺฏุฑ ุฏุงุฑุฏ.",
  
  // ุชุฑููุฏูุง ุจุงุฒโูุง
  "๐ฎ **ุชุฑููุฏ ุจุงุฒ**: ุฏุฑ ุฏูุฆูุ ุดุฑูุน ุจุง ุญููู ูู ููุดู ุจูุชุฑู ุงุณุชุฑุงุชฺ ูุณุช. ฺฏุงู ุฏูุงุน ูู ู ุญููู ุฏุฑ ุฒูุงู ููุงุณุจ ุจูุชุฑ ุฌูุงุจ ูโุฏูุฏ!",
  "๐ฎ **ุชุฑููุฏ ุจุงุฒ**: ุฏุฑ ุจุงุฒ ุชุงุณุ ุงุณุชุฑุงุชฺ ุฑุณฺฉ ุจุดุชุฑ ุจุฑุง ุจุงุฒฺฉูุงู ฺฉู ุนูุจ ูุณุชูุฏ ุชูุตู ูโุดูุฏ - ุดุงูุณ ุจุฑุฏ ุฑุง ุงูุฒุงุด ูโุฏูุฏ!",
  "๐ฎ **ุชุฑููุฏ ุจุงุฒ**: ุฏุฑ ูุณุงุจูุงุช ุชุงูพุ ุฏูุช ูููโุชุฑ ุงุฒ ุณุฑุนุช ุงุณุช. ุงุดุชุจุงูุงุช ุชุงูพ ุงูุชุงุฒ ุดูุง ุฑุง ฺฉุงูุด ูโุฏููุฏ!",
  
  // ูุฏุฑุช ุณุฑูุงู
  "๐ฆ **ูุฏุฑุช ุณุฑูุงู**: ููุฌูุฏ ุฎูุฏ ุฑุง ุจู ุณู ุจุฎุด ุชูุณู ฺฉูุฏ: ุฎุฑุฌ ุฑูุฒุงูู (30%)ุ ูพุณโุงูุฏุงุฒ (50%) ู ุณุฑูุงูโฺฏุฐุงุฑ (20%) - ุฑูุด ุญุฑููโุงโูุง!",
  "๐ฆ **ูุฏุฑุช ุณุฑูุงู**: ูุฑฺฏุฒ ุจุด ุงุฒ 30% ุฏุงุฑุง ุฎูุฏ ุฑุง ุฏุฑ ฺฉ ููุฑุฏ ุณุฑูุงูโฺฏุฐุงุฑ ูฺฉูุฏ. ุชููุน ุณุฑูุงูโฺฏุฐุงุฑ ุฑุณฺฉ ุฑุง ฺฉุงูุด ูโุฏูุฏ!",
  "๐ฆ **ูุฏุฑุช ุณุฑูุงู**: ูุฒูู ฺฉุฑุฏู ุจุฑุง ุงุฑุชูุง ุธุฑูุชโูุง ุณุฑูุงูโฺฏุฐุงุฑ ุจููุฏูุฏุช ูุญุณูุจ ูโุดูุฏ ู ุจุงุฒฺฏุดุช ุณุฑูุงู ุฎูุจ ุฏุงุฑุฏ.",
  
  // ุฑุงูฺฉุงุฑูุง ฺฉูู
  "๐ฐ **ุฑุงูฺฉุงุฑ ฺฉูู**: ุนุถูุช ุฏุฑ ฺฉููโูุง ูุนุงู ูโุชูุงูุฏ ุฏุฑุขูุฏ ุฑูุฒุงูู ุดูุง ุฑุง ุชุง 30% ุงูุฒุงุด ุฏูุฏ!",
  "๐ฐ **ุฑุงูฺฉุงุฑ ฺฉูู**: ูุจู ุงุฒ ุฌูฺฏ ฺฉููโูุงุ ููุงุจุน ุฎูุฏ ุฑุง ุฐุฎุฑู ฺฉูุฏ ุชุง ุจุชูุงูุฏ ุจู ูููุน ุงุฒ ุขููุง ุงุณุชูุงุฏู ฺฉูุฏ.",
  "๐ฐ **ุฑุงูฺฉุงุฑ ฺฉูู**: ุจุฑุง ูพุดุฑูุช ุณุฑุนโุชุฑ ฺฉููุ ุจุฎุด ุงุฒ ุฏุฑุขูุฏ ุฑูุฒุงูู ุฑุง ุจู ุฎุฒุงูู ุงูุฏุง ฺฉูุฏ. ููููุช ฺฉูู ุจู ููุน ููู ุงุนุถุงุณุช!",
  
  // ูฺฉุงุช ุณุฑูุช ู ุฏูุงุน
  "๐ **ูฺฉุชู ุงููุช**: ุณฺฉูโูุง ุฎูุฏ ุฑุง ุฏุฑ ุจุงูฺฉ ูฺฏูุฏุงุฑ ฺฉูุฏ ุชุง ุงุฒ ุณุฑูุช ูุญุงูุธุช ุดููุฏ. ุณุงุฑูุงู ููโุชูุงููุฏ ุจู ุญุณุงุจ ุจุงูฺฉ ุฏุณุชุฑุณ ูพุฏุง ฺฉููุฏ!",
  "๐ **ูฺฉุชู ุงููุช**: ุงุฑุชูุง ุณุณุชูโูุง ุงููุช ุฎุงูู ูุฒููโุจุฑ ุงุณุช ุงูุง ุงุฒ ุณุฑูุชโูุง ูพ ุฏุฑ ูพ ุฌููฺฏุฑ ูโฺฉูุฏ ู ุฏุฑ ุจููุฏูุฏุช ุจู ุตุฑูู ุงุณุช.",
  "๐ **ูฺฉุชู ุงููุช**: ุขุชู ยซููู ูุงูุฑุฆยป ุจุงุนุซ ูโุดูุฏ ุฎุงูู ุดูุง ุจุฑุง ุณุงุฑูุงู ูุงุจู ูุดุงูุฏู ูุจุงุดุฏ - ฺฉ ุณุฑูุงูโฺฏุฐุงุฑ ุนุงู ุจุฑุง ุงูุฑุงุฏ ุซุฑูุชููุฏ!",
  
  // ูฺฉุงุช ุทูุฒุขูุฒ
  "๐ **ูฺฉุชู ุทูุฒุขูุฒ**: ุขุง ูโุฏุงูุณุชุฏ ฺฉุงุฑุจุฑุงู ฺฉู ุฏุฑ ุจุงูฺฉ ุณูพุฑุฏูโฺฏุฐุงุฑ ูโฺฉููุฏุ ฺฉูุชุฑ ุฏฺุงุฑ ุณุฑูุช ูโุดููุฏุ ุณุงุฑูุงู ูู ุชุฑุฌุญ ูโุฏููุฏ ฺฉุงุฑุดุงู ุฑุงุญุช ุจุงุดุฏ! ๐ฆนโโ๏ธ",
  "๐ **ูฺฉุชู ุทูุฒุขูุฒ**: ุจุดุชุฑู ุชููุจ ุฏุฑ ุจุงุฒ ุชุงุณุ ููุช ฺฉุฑุฏู ุฑู ุชุงุณโูุงุณุช! ุฎูุจ ุดุฏ ุฏุณฺฉูุฑุฏ ูุงุจูุช ููุช ฺฉุฑุฏู ูุฏุงุฑุฏ! ๐ฒ",
  "๐ **ูฺฉุชู ุทูุฒุขูุฒ**: ุจุฑุฎ ฺฉุงุฑุจุฑุงู ุขููุฏุฑ ุฏุฑ ุจุงูฺฉ ูพูู ุฏุงุฑูุฏ ฺฉู ุฑุฆุณ ุจุงูฺฉ ุฑุง ุงุณุชุฎุฏุงู ฺฉุฑุฏูโุงูุฏ ุชุง ูพููโูุงุดุงู ุฑุง ุจุดูุงุฑุฏ! ๐ธ",
  "๐ **ูฺฉุชู ุทูุฒุขูุฒ**: ุณุฑูุช ุงุฒ ฺฉ ุณุงุฑูุ ุฌุฑู ูุณุชุ ฺฉ ุณุฑูุณ ุฎุฏูุงุช ูุญุณูุจ ูโุดูุฏ! ๐คฃ",
  "๐ **ูฺฉุชู ุทูุฒุขูุฒ**: ุงฺฏุฑ ุตุฏ ุจุงุฑ ุฏุฑ ุจุงุฒ ุดุฑ ุง ุฎุท ุจุจุงุฒุฏุ ุณฺฉู ุดูุง ุฎุฑุงุจ ุงุณุช ูู ุดุงูุณุชุงู! ๐ช",
  
  // ูฺฉุงุช ูุฑุจูุท ุจู ุงุฑุชูุงุก
  "โญ **ูฺฉุชู ุงุฑุชูุงุก**: ุงุฑุชูุงุก ุณุทุญ ฺฉุงุฑุจุฑ ูโุชูุงูุฏ ุฏุณุชุฑุณ ุดูุง ุจู ูุงุจูุชโูุง ุจุดุชุฑ ุฑุง ูุฑุงูู ฺฉูุฏ. ุณุทุญ 10 ุฏุณุชุฑุณ ุจู ุญุณุงุจ ุทูุง ุจุงูฺฉ ูโุฏูุฏ!",
  "โญ **ูฺฉุชู ุงุฑุชูุงุก**: ุขุชูโูุง ุจูุณุชุฑ XP ุฑุง ุฏุฑ ุฒูุงู ุชฺฉูู ฺฉูุฆุณุชโูุง ุจุฒุฑฺฏ ุงุณุชูุงุฏู ฺฉูุฏ ุชุง ุชุฌุฑุจู ุฏู ุจุฑุงุจุฑ ุฏุฑุงูุช ฺฉูุฏ!",
  "โญ **ูฺฉุชู ุงุฑุชูุงุก**: ฺุงูุดโูุง ุฏุณุชุงูุฑุฏ ยซุณุฎุชยป ููุชโฺฏุฑ ูุณุชูุฏ ุงูุง ูพุงุฏุงุด ูููโุงูุนุงุฏูโุง ุฏุงุฑูุฏ. ุขููุง ุฑุง ูุงุฏุฏู ูฺฏุฑุฏ!",
  
  // ูฺฉุงุช ุฏูุณุช ู ุงุฌุชูุงุน
  "๐ฅ **ูฺฉุชู ุงุฌุชูุงุน**: ุงุฑุณุงู ูุฏู ุจู ุฏูุณุชุงู ุจุงุนุซ ุงูุฒุงุด ุณุทุญ ุฏูุณุช ูโุดูุฏ ู ุฏุฑ ุณุทูุญ ุจุงูุงุชุฑ ูุฒุงุง ุจุดุชุฑ ุฏุงุฑุฏ!",
  "๐ฅ **ูฺฉุชู ุงุฌุชูุงุน**: ุจูุชุฑู ุฒูุงู ุจุฑุง ุงูุชู ุฑูุจ ุฏุฑ ุจุงุฒโูุงุ ุณุงุนุชโูุง ุดููุบ ุณุฑูุฑ (7 ุชุง 11 ุดุจ) ุงุณุช!",
  "๐ฅ **ูฺฉุชู ุงุฌุชูุงุน**: ฺฉูฺฉ ุจู ฺฉุงุฑุจุฑุงู ุชุงุฒูโูุงุฑุฏ ุจุงุนุซ ุฏุฑุงูุช XP ุงุถุงู ู ุงูุชุฎุงุฑ ยซุฑุงูููุง ููุขููุฒุงูยป ูโุดูุฏ!",
  
  // ูฺฉุงุช ูพุดุฑูุชู
  "๐ง **ูฺฉุชู ูพุดุฑูุชู**: ุงุณุชูุงุฏู ููุฒูุงู ุงุฒ ุขุชูโูุง ุจูุณุชุฑ ูุฎุชูู ุงุซุฑ ุชุฌูุน ุฏุงุฑุฏ ู ูโุชูุงูุฏ ูพุดุฑูุช ุดูุง ุฑุง ฺูุฏ ุจุฑุงุจุฑ ฺฉูุฏ!",
  "๐ง **ูฺฉุชู ูพุดุฑูุชู**: ุงุณุชูุงุฏู ุงุฒ ุขุชู ยซฺฉุฑุณุชุงู ุขูุงูุฒยป ุฏุฑ ุจุงุฒุงุฑ ุณูุงู ุงูฺฏููุง ููุช ุฑุง ุจู ุดูุง ูุดุงู ูโุฏูุฏ - ฺฉ ูุฒุช ุฑูุงุจุช ุนุงู!",
  "๐ง **ูฺฉุชู ูพุดุฑูุชู**: ููุงููฺฏ ุจุง ููโฺฉููโูุง ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุจูุณุชุฑูุง ฺฉูู ุฏุฑ ฺฉ ุฒูุงูุ ุจูุฑูโูุฑ ุฑุง ุชุง 50% ุงูุฒุงุด ูโุฏูุฏ!"
];

/**
 * ุชูุธู ฺฉุงูุงู ุจุฑุง ุงุฑุณุงู ุฎูุฏฺฉุงุฑ ูฺฉุงุช
 * @param guildId ุขุฏ ุณุฑูุฑ
 * @param channelId ุขุฏ ฺฉุงูุงู
 * @param interval ูุงุตูู ุฒูุงู ุงุฑุณุงู ูฺฉุงุช (ุจู ุณุงุนุช)
 * @returns ูพุงู ููููุช ุง ุฎุทุง
 */
export async function setTipChannel(guildId: string, channelId: string, interval: number): Promise<string> {
  try {
    // ุจุฑุฑุณ ูุนุชุจุฑ ุจูุฏู ููุงุฏุฑ ูุฑูุฏ
    if (!guildId || !channelId) {
      return 'โ ููุงุฏุฑ ูุฑูุฏ ูุงูุนุชุจุฑ ูุณุชูุฏ.';
    }
    
    // ุจุฑุฑุณ ูุนุชุจุฑ ุจูุฏู ูุงุตูู ุฒูุงู
    if (interval < 1 || interval > 24) {
      return 'โ ูุงุตูู ุฒูุงู ุจุงุฏ ุจู 1 ุชุง 24 ุณุงุนุช ุจุงุดุฏ.';
    }
    
    // ุฐุฎุฑู ุชูุธูุงุช ุฏุฑ ุฏุชุงุจุณ
    const settings = {
      guildId,
      channelId,
      interval,
      isActive: true,
      lastTipTime: Date.now()
    };
    
    // ุฐุฎุฑู ุง ุจูโุฑูุฒุฑุณุงู ุชูุธูุงุช
    await storage.setTipChannelSettings(settings);
    
    return `โ ฺฉุงูุงู <#${channelId}> ุจุง ููููุช ุจุฑุง ุงุฑุณุงู ูฺฉุงุช ูุฑ ${interval} ุณุงุนุช ุชูุธู ุดุฏ.`;
  } catch (error) {
    console.error('Error setting tip channel:', error);
    return 'โ ุฎุทุง ุฏุฑ ุชูุธู ฺฉุงูุงู ูฺฉุงุช. ูุทูุงู ุฏูุจุงุฑู ุชูุงุด ฺฉูุฏ.';
  }
}

/**
 * ุบุฑูุนุงู ฺฉุฑุฏู ุงุฑุณุงู ุฎูุฏฺฉุงุฑ ูฺฉุงุช
 * @param guildId ุขุฏ ุณุฑูุฑ
 * @returns ูพุงู ููููุช ุง ุฎุทุง
 */
export async function disableTipChannel(guildId: string): Promise<string> {
  try {
    // ุจุฑุฑุณ ูุฌูุฏ ุชูุธูุงุช
    const settings = await storage.getTipChannelSettings(guildId);
    
    if (!settings) {
      return 'โ ูฺ ฺฉุงูุงู ูฺฉุงุช ุจุฑุง ุงู ุณุฑูุฑ ุชูุธู ูุดุฏู ุงุณุช.';
    }
    
    // ุบุฑูุนุงู ฺฉุฑุฏู ุงุฑุณุงู ูฺฉุงุช
    settings.isActive = false;
    await storage.setTipChannelSettings(settings);
    
    return 'โ ุงุฑุณุงู ุฎูุฏฺฉุงุฑ ูฺฉุงุช ุจุง ููููุช ุบุฑูุนุงู ุดุฏ.';
  } catch (error) {
    console.error('Error disabling tip channel:', error);
    return 'โ ุฎุทุง ุฏุฑ ุบุฑูุนุงู ฺฉุฑุฏู ฺฉุงูุงู ูฺฉุงุช. ูุทูุงู ุฏูุจุงุฑู ุชูุงุด ฺฉูุฏ.';
  }
}

/**
 * ุงุฑุณุงู ฺฉ ูฺฉุชู ุชุตุงุฏู ุจู ฺฉุงูุงู
 * @param channel ฺฉุงูุงู ูุชู
 */
export async function sendRandomTip(channel: TextChannel): Promise<void> {
  try {
    // ุงูุชุฎุงุจ ฺฉ ูฺฉุชู ุชุตุงุฏู
    const randomTip = tipsList[Math.floor(Math.random() * tipsList.length)];
    
    // ุงุฑุณุงู ุจู ฺฉุงูุงู
    await channel.send({
      content: `${randomTip}\n\n*ุงู ูฺฉุชู ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุชูุณุท Ccoin Bot ุงุฑุณุงู ุดุฏู ุงุณุช* ๐ค`
    });
    
    console.log(`Tip sent to channel ${channel.name} (${channel.id})`);
  } catch (error) {
    console.error(`Error sending tip to channel ${channel.id}:`, error);
  }
}

/**
 * ุจุฑุฑุณ ู ุงุฑุณุงู ูฺฉุงุช ุฏุฑ ุตูุฑุช ูุงุฒ
 * ุงู ุชุงุจุน ุจุงุฏ ุฏุฑ ููุงุตู ุฒูุงู ููุธู (ูุซูุงู ูุฑ 5 ุฏููู) ูุฑุงุฎูุงู ุดูุฏ
 * @param client ฺฉูุงูุช ุฏุณฺฉูุฑุฏ
 */
export async function checkAndSendTips(client: any): Promise<void> {
  try {
    // ุฏุฑุงูุช ููู ุชูุธูุงุช ฺฉุงูุงูโูุง ูฺฉุงุช ูุนุงู
    const allSettings = await storage.getAllActiveTipChannelSettings();
    
    if (!allSettings || allSettings.length === 0) {
      return; // ูฺ ฺฉุงูุงู ูุนุงู ูุฌูุฏ ูุฏุงุฑุฏ
    }
    
    const currentTime = Date.now();
    
    // ุจุฑุฑุณ ูุฑ ฺฉุงูุงู
    for (const settings of allSettings) {
      // ุงฺฏุฑ ฺฉุงูุงู ุบุฑูุนุงู ุงุณุชุ ุขู ุฑุง ูุงุฏุฏู ุจฺฏุฑ
      if (!settings.isActive) continue;
      
      // ูุญุงุณุจู ุฒูุงู ฺฏุฐุดุชู ุงุฒ ุขุฎุฑู ุงุฑุณุงู (ุจู ููโุซุงูู)
      const timeSinceLastTip = settings.lastTipTime 
        ? currentTime - settings.lastTipTime 
        : settings.interval * 3600000 + 1; // ุงฺฏุฑ ุขุฎุฑู ุฒูุงู ูุฌูุฏ ูุฏุงุฑุฏุ ูุฑุถ ฺฉู ุฒูุงู ุฑุณุฏู
      
      // ุชุจุฏู ูุงุตูู ุฒูุงู ุงุฒ ุณุงุนุช ุจู ููโุซุงูู
      const intervalMs = settings.interval * 3600000;
      
      // ุงฺฏุฑ ุฒูุงู ุงุฑุณุงู ูฺฉุชู ุจุนุฏ ุฑุณุฏู ุงุณุช
      if (timeSinceLastTip >= intervalMs) {
        try {
          // ุฏุฑุงูุช ฺฉุงูุงู
          const guild = client.guilds.cache.get(settings.guildId);
          
          if (!guild) {
            console.log(`Guild ${settings.guildId} not found, skipping tip`);
            continue;
          }
          
          const channel = guild.channels.cache.get(settings.channelId) as TextChannel;
          
          // ุจุฑุฑุณ ููุน ฺฉุงูุงู: ุจุงุฏ ฺฉุงูุงู ูุชู ุจุงุดุฏ
          // ChannelType.GuildText = 0 ุฏุฑ ุฏุณฺฉูุฑุฏ ุฌุฏุฏ
          if (!channel || (channel.type !== 0 && channel.type !== 'GUILD_TEXT')) {
            console.log(`Channel ${settings.channelId} not found or not text channel, skipping tip`);
            continue;
          }
          
          // ุงุฑุณุงู ูฺฉุชู
          await sendRandomTip(channel);
          
          // ุจูโุฑูุฒุฑุณุงู ุฒูุงู ุขุฎุฑู ุงุฑุณุงู
          settings.lastTipTime = currentTime;
          await storage.setTipChannelSettings(settings);
          
        } catch (channelError) {
          console.error(`Error processing tip for channel ${settings.channelId}:`, channelError);
        }
      }
    }
  } catch (error) {
    console.error('Error in checking and sending tips:', error);
  }
}