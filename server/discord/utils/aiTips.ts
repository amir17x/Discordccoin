import { log } from "../../vite";
import { generateAIResponse } from "../services/aiService";

/**
 * مجموعه موضوعات تخصصی برای تولید نکات
 * هر موضوع به عنوان یک دسته‌بندی برای تولید نکات توسط هوش مصنوعی استفاده می‌شود
 */
export const tipTopics = [
  "اقتصاد و مدیریت Ccoin",
  "استراتژی‌های بازی و رقابت",
  "ویژگی‌های پنهان ربات",
  "قابلیت‌های جدید",
  "راهکارهای افزایش درآمد",
  "منابع کسب Ccoin",
  "مدیریت کلن‌ها",
  "شخصی‌سازی پروفایل",
  "رازهای موفقیت در بازی‌های گروهی",
  "نکات امنیتی و محافظت از حساب",
  "ترفندهای معاملات",
  "مزایای عضویت در کلن‌ها",
  "نکاتی برای تازه‌واردان",
  "استفاده بهینه از فروشگاه",
  "آیتم‌های ویژه و کاربرد آن‌ها"
];

/**
 * تولید یک نکته اتفاقی با استفاده از CCOIN AI
 * @returns قول برای دریافت یک نکته تولید شده توسط هوش مصنوعی
 */
export async function generateAITip(): Promise<string> {
  try {
    // انتخاب یک موضوع اتفاقی از لیست موضوعات
    const randomTopic = tipTopics[Math.floor(Math.random() * tipTopics.length)];
    
    // ساخت پرامپت برای CCOIN AI با تأکید بیشتر بر زبان فارسی
    const prompt = `به عنوان یک متخصص در ربات دیسکورد Ccoin که دارای سیستم اقتصادی، کلن‌ها، بازی‌های گروهی، و مدیریت آیتم‌هاست، 
      یک نکته جالب، کوتاه و کاربردی (حداکثر ۴ جمله) با موضوع "${randomTopic}" ارائه بده.
      
      شرایط مهم:
      1. پاسخ حتماً باید به زبان فارسی (پارسی) باشد
      2. از ایموجی‌های مناسب استفاده کن تا پیام جذاب‌تر شود
      3. پاسخ فقط شامل متن نکته باشد، بدون عنوان یا مقدمه اضافی
      4. اگر کلمه تخصصی انگلیسی استفاده می‌کنی، معادل فارسی آن را در پرانتز ذکر کن
      5. از کلمات و اصطلاحات رایج میان کاربران ایرانی دیسکورد استفاده کن
      6. سعی کن نکته خیلی جذاب، خفن و کاربردی باشد`;
    
    // دریافت پاسخ از CCOIN AI
    const response = await generateAIResponse(prompt, 'other', 'خلاقانه');
    
    log(`AI tip generated successfully with topic: ${randomTopic}`, 'discord');
    log(`🤖 نکته هوشمند با استفاده از CCOIN AI تولید شد.`);
    
    return response;
  } catch (error) {
    log(`Error generating AI tip: ${error}`, 'error');
    
    // در صورت خطا، یک نکته پیش‌فرض برگردان
    return "💡 با استفاده از دستور `/daily` می‌توانید هر ۲۴ ساعت یکبار جایزه روزانه خود را دریافت کنید. با حفظ استریک ۷ روزه، جوایز ویژه‌ای دریافت خواهید کرد!";
  }
}

/**
 * تولید یک نکته در مورد موضوع مشخص
 * @param topic موضوع برای تولید نکته
 * @returns قول برای دریافت یک نکته تولید شده توسط هوش مصنوعی
 */
export async function generateTopicTip(topic: string): Promise<string> {
  try {
    // ساخت پرامپت برای CCOIN AI با تأکید بیشتر بر زبان فارسی
    const prompt = `به عنوان یک متخصص در ربات دیسکورد Ccoin که دارای سیستم اقتصادی، کلن‌ها، بازی‌های گروهی، و مدیریت آیتم‌هاست، 
      یک نکته جالب، کوتاه و کاربردی (حداکثر ۴ جمله) با موضوع "${topic}" ارائه بده.
      
      شرایط مهم:
      1. پاسخ حتماً باید به زبان فارسی (پارسی) باشد
      2. از ایموجی‌های مناسب استفاده کن تا پیام جذاب‌تر شود
      3. پاسخ فقط شامل متن نکته باشد، بدون عنوان یا مقدمه اضافی
      4. اگر کلمه تخصصی انگلیسی استفاده می‌کنی، معادل فارسی آن را در پرانتز ذکر کن
      5. از کلمات و اصطلاحات رایج میان کاربران ایرانی دیسکورد استفاده کن
      6. سعی کن نکته خیلی جذاب، خفن و کاربردی باشد`;
    
    // دریافت پاسخ از CCOIN AI
    const response = await generateAIResponse(prompt, 'other', 'خلاقانه');
    
    log(`AI topic tip generated successfully for topic: ${topic}`, 'discord');
    log(`🤖 نکته هوشمند با موضوع ${topic} با استفاده از CCOIN AI تولید شد.`);
    
    return response;
  } catch (error) {
    log(`Error generating AI topic tip: ${error}`, 'error');
    
    // در صورت خطا، یک نکته پیش‌فرض برگردان
    return `💡 ${topic} یکی از ویژگی‌های مهم ربات Ccoin است که به شما کمک می‌کند تجربه بهتری داشته باشید. برای اطلاعات بیشتر از دستور /help استفاده کنید!`;
  }
}