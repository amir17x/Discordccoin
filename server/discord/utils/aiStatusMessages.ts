/**
 * Ø³ÛŒØ³ØªÙ… Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ùˆ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù…Ø­Ù„ÛŒ
 * 
 * Ø§ÛŒÙ† Ù…Ø§Ú˜ÙˆÙ„ Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø®ÙˆØ¯Ú©Ø§Ø± Ùˆ Ø·Ù†Ø²Ø¢Ù…ÛŒØ² Ø¨Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
 * Ùˆ ÛŒØ§ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù…Ø­Ù„ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù‡Ø¯Ù Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø­ØªÙˆØ§ÛŒ Ø³Ø±Ú¯Ø±Ù…â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ùˆ Ø¬Ø°Ø§Ø¨ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§Ø³Øª.
 */

import { Client, ActivityType } from 'discord.js';
import { generateAIResponse } from '../services/aiService';
import { log } from '../../vite';
import * as fs from 'fs';
import * as path from 'path';
import {
  getRandomStatusMessage,
  getRandomStatusMessageByTheme,
  mapDefaultThemeToLibraryTheme,
  StatusMessage
} from './statusMessageLibrary';

// ØªÙ…â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª
const statusThemes = [
  'Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ Ùˆ Ø³Ø±Ú¯Ø±Ù…ÛŒ',
  'Ø§Ù‚ØªØµØ§Ø¯ Ùˆ Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯',
  'Ø¯ÙˆØ³ØªÛŒ Ùˆ Ø±ÙˆØ§Ø¨Ø· Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ',
  'ØªÛŒÙ…â€ŒÙ‡Ø§ Ùˆ Ú©Ù„Ù†â€ŒÙ‡Ø§',
  'Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯ Ø§ÛŒÙ†ØªØ±Ù†ØªÛŒ',
  'Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ',
  'Ù‚Ø¯Ø±Øª Ùˆ Ø±Ù‚Ø§Ø¨Øª',
  'Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ',
  'Ø¢ÛŒÙ†Ø¯Ù‡ Ø¯ÛŒØ¬ÛŒØªØ§Ù„',
  'ÙÙ†Ø§ÙˆØ±ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†ÙˆÛŒÙ†'
];

// Ù†ÙˆØ¹ Ø¯Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙˆØ¶Ø¹ÛŒØª
interface StatusConfig {
  useAI: boolean;
}

// Ù…ØªØºÛŒØ± Ø¨Ø±Ø§ÛŒ ØªØ¹ÛŒÛŒÙ† Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯ ÛŒØ§ Ø§Ø² Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù…Ø­Ù„ÛŒ
// Ø§Ø¨ØªØ¯Ø§ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ùˆ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ Ø¨Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù…Ø­Ù„ÛŒ ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
let useAI = true;
// ØªØ¹Ø¯Ø§Ø¯ Ø®Ø·Ø§Ù‡Ø§ÛŒ Ù…ØªÙˆØ§Ù„ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
let aiFailureCount = 0;
// Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ø®Ø·Ø§Ù‡Ø§ÛŒ Ù…Ø¬Ø§Ø² Ù‚Ø¨Ù„ Ø§Ø² ØªØºÛŒÛŒØ± Ø¨Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù…Ø­Ù„ÛŒ
const MAX_AI_FAILURES = 3;

/**
 * Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³ÛŒØ³ØªÙ… Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± ÙˆØ¶Ø¹ÛŒØª
 * @param client Ú©Ù„Ø§ÛŒÙ†Øª Ø¯ÛŒØ³Ú©ÙˆØ±Ø¯
 * @param intervalMinutes ÙØ§ØµÙ„Ù‡ Ø²Ù…Ø§Ù†ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ (Ø¯Ù‚ÛŒÙ‚Ù‡)
 */
export async function setupAutoStatusUpdater(client: Client, intervalMinutes: number = 20) {
  try {
    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙÙˆØ±ÛŒ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ÛŒ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ
    await updateBotStatus(client);
    
    // ØªÙ†Ø¸ÛŒÙ… Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ
    setInterval(async () => {
      try {
        await updateBotStatus(client);
      } catch (error) {
        log(`Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø±Ø¨Ø§Øª: ${error}`, 'error');
      }
    }, intervalMinutes * 60 * 1000);
    
    log(`Ø³ÛŒØ³ØªÙ… Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§ ÙØ§ØµÙ„Ù‡ ${intervalMinutes} Ø¯Ù‚ÛŒÙ‚Ù‡ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯`, 'info');
    return true;
  } catch (error) {
    log(`Ø®Ø·Ø§ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³ÛŒØ³ØªÙ… Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª: ${error}`, 'error');
    return false;
  }
}

/**
 * Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø±Ø¨Ø§Øª Ø¨Ø§ Ù¾ÛŒØ§Ù… Ø·Ù†Ø²Ø¢Ù…ÛŒØ² Ø¬Ø¯ÛŒØ¯
 * @param client Ú©Ù„Ø§ÛŒÙ†Øª Ø¯ÛŒØ³Ú©ÙˆØ±Ø¯
 */
async function updateBotStatus(client: Client) {
  try {
    // Ø§Ù†ØªØ®Ø§Ø¨ ØªÙ… ØªØµØ§Ø¯ÙÛŒ
    const theme = statusThemes[Math.floor(Math.random() * statusThemes.length)];
    
    let statusMessage: string;
    
    if (useAI) {
      try {
        // ØªÙˆÙ„ÛŒØ¯ Ù¾ÛŒØ§Ù… Ø·Ù†Ø²Ø¢Ù…ÛŒØ² Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
        statusMessage = await generateStatusWithAI(theme);
        // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø®Ø·Ø§ Ø¯Ø± ØµÙˆØ±Øª Ù…ÙˆÙÙ‚ÛŒØª
        aiFailureCount = 0;
      } catch (error) {
        // Ø§ÙØ²Ø§ÛŒØ´ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø®Ø·Ø§
        aiFailureCount++;
        
        // Ø§Ú¯Ø± ØªØ¹Ø¯Ø§Ø¯ Ø®Ø·Ø§Ù‡Ø§ Ø§Ø² Ø­Ø¯ Ù…Ø¬Ø§Ø² Ø¨ÛŒØ´ØªØ± Ø´Ø¯ØŒ Ø¨Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù…Ø­Ù„ÛŒ ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
        if (aiFailureCount >= MAX_AI_FAILURES) {
          useAI = false;
          log(`ØªØºÛŒÛŒØ± Ø¨Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù…Ø­Ù„ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ ${aiFailureCount} Ø®Ø·Ø§ÛŒ Ù…ØªÙˆØ§Ù„ÛŒ Ø¯Ø± Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ`, 'warning');
        }
        
        // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù…Ø­Ù„ÛŒ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§
        statusMessage = generateStatusFromLibrary(theme);
      }
    } else {
      // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù…Ø­Ù„ÛŒ
      statusMessage = generateStatusFromLibrary(theme);
    }
    
    // ØªÙ†Ø¸ÛŒÙ… ÙˆØ¶Ø¹ÛŒØª Ø¬Ø¯ÛŒØ¯
    client.user?.setActivity(statusMessage, { type: ActivityType.Watching });
    
    log(`ÙˆØ¶Ø¹ÛŒØª Ø±Ø¨Ø§Øª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯: ${statusMessage}`, 'info');
    
    return statusMessage;
  } catch (error) {
    log(`Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ Ù¾ÛŒØ§Ù… ÙˆØ¶Ø¹ÛŒØª: ${error}`, 'error');
    
    // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù¾ÛŒØ§Ù… Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§
    const fallbackMsg = generateStatusFromLibrary();
    client.user?.setActivity(fallbackMsg, { type: ActivityType.Watching });
    
    log(`Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù¾ÛŒØ§Ù… Ù¾ÛŒØ´â€ŒÙØ±Ø¶: ${fallbackMsg}`, 'info');
    return fallbackMsg;
  }
}

/**
 * ØªÙˆÙ„ÛŒØ¯ Ù¾ÛŒØ§Ù… ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
 * @param theme ØªÙ… Ù¾ÛŒØ§Ù…
 * @returns Ù¾ÛŒØ§Ù… ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡
 */
async function generateStatusWithAI(theme: string): Promise<string> {
  // ØªÙˆÙ„ÛŒØ¯ Ù¾ÛŒØ§Ù… Ø·Ù†Ø²Ø¢Ù…ÛŒØ² Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
  const prompt = `ÛŒÚ© Ù¾ÛŒØ§Ù… Ú©ÙˆØªØ§Ù‡ Ùˆ Ø·Ù†Ø²Ø¢Ù…ÛŒØ² Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± ÙˆØ¶Ø¹ÛŒØª "Ø¯Ø± Ø­Ø§Ù„ ØªÙ…Ø§Ø´Ø§ÛŒ..." ÛŒÚ© Ø±Ø¨Ø§Øª Ø¯ÛŒØ³Ú©ÙˆØ±Ø¯ Ø¨Ù†ÙˆÛŒØ³. 
  
  ØªÙ… Ù¾ÛŒØ§Ù… Ø¨Ø§ÛŒØ¯ Ø¯Ø±Ø¨Ø§Ø±Ù‡ "${theme}" Ø¨Ø§Ø´Ø¯. Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ø¨Ø§ÛŒØ¯ Ø®Ù†Ø¯Ù‡â€ŒØ¯Ø§Ø± Ùˆ Ø¬Ø°Ø§Ø¨ Ø¨Ø§Ø´Ø¯ Ùˆ Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø² Û³Û° Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨ÛŒØ´ØªØ± Ø¨Ø§Ø´Ø¯.
  
  Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§:
  - "Ú†Ø·ÙˆØ±ÛŒ Ù¾ÙˆÙ„Ø¯Ø§Ø± Ø¨Ø´ÛŒÙ…"
  - "Ø¯Ù†Ø¨Ø§Ù„ ÛŒÙ‡ Ø¯ÙˆØ³Øª Ø®ÙˆØ¨"
  - "Ø±ÙˆÛŒØ§ÛŒ Ø±Ø¦ÛŒØ³ Ú©Ù„Ù† Ø´Ø¯Ù†"
  
  ÙÙ‚Ø· Ù…ØªÙ† Ù¾ÛŒØ§Ù… Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ØŒ Ø¨Ø¯ÙˆÙ† Ù‡ÛŒÚ† ØªÙˆØ¶ÛŒØ­ Ø§Ø¶Ø§ÙÙ‡ Ùˆ Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Øª Ù†Ù‚Ù„ Ù‚ÙˆÙ„.`;
  
  // Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø³Ø® Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
  let statusMessage = await generateAIResponse(prompt, "statusMessages");
  
  // Ø­Ø°Ù Ø¹Ù„Ø§Ù…Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ù‚Ù„ Ù‚ÙˆÙ„ Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
  statusMessage = statusMessage.replace(/^["']|["']$/g, '');
  
  // Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ú©ÙˆØªØ§Ù‡ Ø¨ÙˆØ¯Ù† Ù¾ÛŒØ§Ù…
  if (statusMessage.length > 50) {
    statusMessage = statusMessage.substring(0, 47) + '...';
  }
  
  // Ø§ÙØ²ÙˆØ¯Ù† Ø§Ù…ÙˆØ¬ÛŒ Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ù…ÙˆØ¶ÙˆØ¹
  statusMessage = addAppropriateEmoji(statusMessage, theme);
  
  log(`ØªÙˆÙ„ÛŒØ¯ Ù¾ÛŒØ§Ù… Ø·Ù†Ø² Ø¨Ø±Ø§ÛŒ ØªÙ… "${theme}" Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ: "${statusMessage}"`, 'success');
  
  return statusMessage;
}

/**
 * ØªÙˆÙ„ÛŒØ¯ Ù¾ÛŒØ§Ù… ÙˆØ¶Ø¹ÛŒØª Ø§Ø² Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù…Ø­Ù„ÛŒ
 * @param theme ØªÙ… Ù¾ÛŒØ§Ù… (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
 * @returns Ù¾ÛŒØ§Ù… ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡
 */
function generateStatusFromLibrary(theme?: string): string {
  let statusMessage: StatusMessage;
  
  if (theme) {
    // ØªØ¨Ø¯ÛŒÙ„ ØªÙ… Ø±Ø¨Ø§Øª Ø¨Ù‡ ØªÙ… Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡
    const libraryTheme = mapDefaultThemeToLibraryTheme(theme);
    
    // Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù… Ø§Ø² Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªÙ…
    const message = getRandomStatusMessageByTheme(libraryTheme);
    
    // Ø§Ú¯Ø± Ù¾ÛŒØ§Ù…ÛŒ Ø¨Ø§ Ø§ÛŒÙ† ØªÙ… Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯ØŒ ÛŒÚ© Ù¾ÛŒØ§Ù… ØªØµØ§Ø¯ÙÛŒ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†ÛŒÙ…
    statusMessage = message || getRandomStatusMessage();
  } else {
    // Ø¯Ø±ÛŒØ§ÙØª ÛŒÚ© Ù¾ÛŒØ§Ù… ØªØµØ§Ø¯ÙÛŒ Ø§Ø² Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡
    statusMessage = getRandomStatusMessage();
  }
  
  log(`ØªÙˆÙ„ÛŒØ¯ Ù¾ÛŒØ§Ù… Ø·Ù†Ø² Ø¨Ø±Ø§ÛŒ ØªÙ… "${statusMessage.theme}" Ø§Ø² Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù…Ø­Ù„ÛŒ: "${statusMessage.text}"`, 'success');
  
  return statusMessage.text;
}

/**
 * Ø§ÙØ²ÙˆØ¯Ù† Ø§Ù…ÙˆØ¬ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ø¨Ù‡ Ù¾ÛŒØ§Ù… Ø¨Ø± Ø§Ø³Ø§Ø³ ØªÙ…
 * @param message Ù¾ÛŒØ§Ù… Ø§ØµÙ„ÛŒ
 * @param theme ØªÙ… Ù¾ÛŒØ§Ù…
 * @returns Ù¾ÛŒØ§Ù… Ø¨Ø§ Ø§Ù…ÙˆØ¬ÛŒ Ù…Ù†Ø§Ø³Ø¨
 */
function addAppropriateEmoji(message: string, theme: string): string {
  // Ø§Ú¯Ø± Ù¾ÛŒØ§Ù… Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ù…ÙˆØ¬ÛŒ Ø¯Ø§Ø±Ø¯ØŒ Ø¢Ù† Ø±Ø§ Ø¨Ø±Ù†Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†ÛŒÙ…
  // Ù„ÛŒØ³Øª Ø¨Ø±Ø®ÛŒ Ø§Ø² Ù…Ø¹Ù…ÙˆÙ„â€ŒØªØ±ÛŒÙ† Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ
  const commonEmojis = [
    'ğŸ˜€', 'ğŸ˜', 'ğŸ˜‚', 'ğŸ¤£', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜…', 'ğŸ˜†', 'ğŸ˜‰', 'ğŸ˜Š', 'ğŸ˜‹', 'ğŸ˜', 'ğŸ˜', 'ğŸ˜˜', 'ğŸ™‚', 'ğŸ™„', 'ğŸ˜', 'ğŸ˜‘', 'ğŸ˜¶', 'ğŸ™ƒ', 'ğŸ˜',
    'ğŸ’°', 'ğŸ’µ', 'ğŸ’¸', 'ğŸ“ˆ', 'ğŸ¤‘', 'ğŸ…', 'ğŸ®', 'ğŸ¯', 'ğŸ²', 'ğŸª', 'ğŸ¨', 'ğŸ¤', 'ğŸ‘‹', 'ğŸ«‚', 'ğŸ¤—', 'â¤ï¸', 'ğŸ‘¥', 'ğŸ›¡ï¸', 'âš”ï¸', 'ğŸ†', 'ğŸ‘‘',
    'ğŸ’»', 'ğŸ“±', 'ğŸŒ', 'ğŸ“Š', 'ğŸ“ˆ', 'ğŸ’¹', 'ğŸ¦', 'ğŸ’ª', 'âš¡', 'ğŸ”¥', 'ğŸ‘Š', 'ğŸ¤–', 'ğŸ§ ', 'ğŸ’¡', 'ğŸ”®', 'ğŸ‘¾', 'ğŸš€', 'ğŸŒ ', 'âš¡'
  ];
  
  // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ ÛŒÚ©ÛŒ Ø§Ø² Ø§Ù…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ Ø¯Ø± Ù…ØªÙ†
  if (commonEmojis.some(emoji => message.includes(emoji))) {
    return message;
  }
  
  // Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ù…ÙˆØ¬ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªÙ…
  let emoji = '';
  
  switch (theme) {
    case 'Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ Ùˆ Ø³Ø±Ú¯Ø±Ù…ÛŒ':
      emoji = ['ğŸ®', 'ğŸ¯', 'ğŸ²', 'ğŸª', 'ğŸ¨'][Math.floor(Math.random() * 5)];
      break;
    case 'Ø§Ù‚ØªØµØ§Ø¯ Ùˆ Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯':
      emoji = ['ğŸ’°', 'ğŸ’µ', 'ğŸ’¸', 'ğŸ“ˆ', 'ğŸ¤‘'][Math.floor(Math.random() * 5)];
      break;
    case 'Ø¯ÙˆØ³ØªÛŒ Ùˆ Ø±ÙˆØ§Ø¨Ø· Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ':
      emoji = ['ğŸ¤', 'ğŸ‘‹', 'ğŸ«‚', 'ğŸ¤—', 'â¤ï¸'][Math.floor(Math.random() * 5)];
      break;
    case 'ØªÛŒÙ…â€ŒÙ‡Ø§ Ùˆ Ú©Ù„Ù†â€ŒÙ‡Ø§':
      emoji = ['ğŸ‘¥', 'ğŸ›¡ï¸', 'âš”ï¸', 'ğŸ†', 'ğŸ‘‘'][Math.floor(Math.random() * 5)];
      break;
    case 'Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯ Ø§ÛŒÙ†ØªØ±Ù†ØªÛŒ':
      emoji = ['ğŸ’»', 'ğŸ“±', 'ğŸ’¸', 'ğŸŒ', 'ğŸ“Š'][Math.floor(Math.random() * 5)];
      break;
    case 'Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ':
      emoji = ['ğŸ“ˆ', 'ğŸ’¹', 'ğŸ’°', 'ğŸ’', 'ğŸ¦'][Math.floor(Math.random() * 5)];
      break;
    case 'Ù‚Ø¯Ø±Øª Ùˆ Ø±Ù‚Ø§Ø¨Øª':
      emoji = ['ğŸ’ª', 'ğŸ†', 'âš¡', 'ğŸ”¥', 'ğŸ‘Š'][Math.floor(Math.random() * 5)];
      break;
    case 'Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ':
      emoji = ['ğŸ¤–', 'ğŸ§ ', 'ğŸ’¡', 'ğŸ”®', 'ğŸ‘¾'][Math.floor(Math.random() * 5)];
      break;
    case 'Ø¢ÛŒÙ†Ø¯Ù‡ Ø¯ÛŒØ¬ÛŒØªØ§Ù„':
      emoji = ['ğŸš€', 'ğŸŒ ', 'ğŸ”®', 'ğŸŒ', 'âš¡'][Math.floor(Math.random() * 5)];
      break;
    case 'ÙÙ†Ø§ÙˆØ±ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†ÙˆÛŒÙ†':
      emoji = ['ğŸ“±', 'ğŸ’»', 'ğŸ”‹', 'ğŸ“¡', 'ğŸ›°ï¸'][Math.floor(Math.random() * 5)];
      break;
    default:
      emoji = ['ğŸ’¡', 'âœ¨', 'ğŸŒŸ', 'ğŸ”¥', 'â­'][Math.floor(Math.random() * 5)];
  }
  
  // Ø§ÙØ²ÙˆØ¯Ù† Ø§Ù…ÙˆØ¬ÛŒ Ø¨Ù‡ Ø§Ù†ØªÙ‡Ø§ÛŒ Ù¾ÛŒØ§Ù…
  return `${message} ${emoji}`;
}

/**
 * ØªÙˆÙ„ÛŒØ¯ ÛŒÚ© Ù¾ÛŒØ§Ù… ÙˆØ¶Ø¹ÛŒØª Ø¬Ø¯ÛŒØ¯ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø³ØªÛŒ
 * @param client Ú©Ù„Ø§ÛŒÙ†Øª Ø¯ÛŒØ³Ú©ÙˆØ±Ø¯
 * @param theme ØªÙ… Ø§Ù†ØªØ®Ø§Ø¨ÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
 * @returns Ù¾ÛŒØ§Ù… ÙˆØ¶Ø¹ÛŒØª ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡
 */
export async function generateNewStatus(client: Client, theme?: string): Promise<string> {
  try {
    // Ø§Ú¯Ø± ØªÙ… Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ ÛŒÚ© ØªÙ… ØªØµØ§Ø¯ÙÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
    const selectedTheme = theme || statusThemes[Math.floor(Math.random() * statusThemes.length)];
    
    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù… ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡
    return await updateBotStatus(client);
  } catch (error) {
    log(`Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ Ø¯Ø³ØªÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¬Ø¯ÛŒØ¯: ${error}`, 'error');
    throw error;
  }
}

/**
 * ØªØºÛŒÛŒØ± Ø±ÙˆØ´ ØªÙˆÙ„ÛŒØ¯ Ù¾ÛŒØ§Ù… ÙˆØ¶Ø¹ÛŒØª (Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ÛŒØ§ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù…Ø­Ù„ÛŒ)
 * @param useArtificialIntelligence Ø¢ÛŒØ§ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯
 */
export function setStatusGenerationMethod(useArtificialIntelligence: boolean): void {
  useAI = useArtificialIntelligence;
  
  log(`Ø±ÙˆØ´ ØªÙˆÙ„ÛŒØ¯ Ù¾ÛŒØ§Ù… ÙˆØ¶Ø¹ÛŒØª ØªØºÛŒÛŒØ± Ú©Ø±Ø¯: ${useAI ? 'Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ' : 'Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù…Ø­Ù„ÛŒ'}`, 'info');
  
  // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø®Ø·Ø§
  if (useAI) {
    aiFailureCount = 0;
  }
}

/**
 * Ø¯Ø±ÛŒØ§ÙØª Ø±ÙˆØ´ ÙØ¹Ù„ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù¾ÛŒØ§Ù… ÙˆØ¶Ø¹ÛŒØª
 * @returns ÙˆØ¶Ø¹ÛŒØª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ÛŒØ§ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù…Ø­Ù„ÛŒ
 */
export function getStatusGenerationMethod(): boolean {
  return useAI;
}