<div class="topbar">
  <div class="topbar-title">
    <h1>ูุฏุฑุช ฺฉุงุฑุจุฑุงู</h1>
    <p>ูุดุงูุฏูุ ูุฑุงุด ู ูุฏุฑุช ฺฉุงุฑุจุฑุงู</p>
  </div>
  
  <div class="topbar-actions">
    <a href="/admin/users/export<%= queryString ? '?' + queryString : '' %>" class="btn">
      <i class="fas fa-file-export"></i> ุฎุฑูุฌ ุงฺฉุณู
    </a>
  </div>
</div>

<!-- ููุชุฑ ู ุฌุณุชุฌู -->
<div class="card">
  <div class="card-body">
    <form action="/admin/users" method="GET" class="search-form">
      <input type="text" name="search" class="form-control" placeholder="ุฌุณุชุฌู ุจุฑ ุงุณุงุณ ูุงู ฺฉุงุฑุจุฑ ุง ุดูุงุณู..." value="<%= search %>">
      
      <div style="min-width: 150px;">
        <select name="status" class="form-select">
          <option value="all" <%= filter.status === 'all' ? 'selected' : '' %>>ููู ฺฉุงุฑุจุฑุงู</option>
          <option value="active" <%= filter.status === 'active' ? 'selected' : '' %>>ฺฉุงุฑุจุฑุงู ูุนุงู</option>
          <option value="banned" <%= filter.status === 'banned' ? 'selected' : '' %>>ฺฉุงุฑุจุฑุงู ูุณุฏูุฏ</option>
        </select>
      </div>
      
      <div style="min-width: 150px;">
        <select name="sortBy" class="form-select">
          <option value="username" <%= sort.by === 'username' ? 'selected' : '' %>>ูุงู ฺฉุงุฑุจุฑ</option>
          <option value="wallet" <%= sort.by === 'wallet' ? 'selected' : '' %>>ููุฌูุฏ ฺฉู ูพูู</option>
          <option value="bank" <%= sort.by === 'bank' ? 'selected' : '' %>>ููุฌูุฏ ุจุงูฺฉ</option>
          <option value="level" <%= sort.by === 'level' ? 'selected' : '' %>>ุณุทุญ</option>
          <option value="joinDate" <%= sort.by === 'joinDate' ? 'selected' : '' %>>ุชุงุฑุฎ ุนุถูุช</option>
        </select>
      </div>
      
      <div style="min-width: 120px;">
        <select name="sortOrder" class="form-select">
          <option value="asc" <%= sort.order === 'asc' ? 'selected' : '' %>>ุตุนูุฏ</option>
          <option value="desc" <%= sort.order === 'desc' ? 'selected' : '' %>>ูุฒูู</option>
        </select>
      </div>
      
      <div style="min-width: 80px;">
        <select name="limit" class="form-select">
          <option value="10" <%= limit === 10 ? 'selected' : '' %>>10</option>
          <option value="20" <%= limit === 20 ? 'selected' : '' %>>20</option>
          <option value="50" <%= limit === 50 ? 'selected' : '' %>>50</option>
          <option value="100" <%= limit === 100 ? 'selected' : '' %>>100</option>
        </select>
      </div>
      
      <button type="submit" class="btn btn-primary">
        <i class="fas fa-search"></i> ุฌุณุชุฌู
      </button>
    </form>
  </div>
</div>

<% if (error) { %>
  <div class="alert alert-danger">
    <i class="fas fa-exclamation-circle"></i>
    ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฑ ูุณุช ฺฉุงุฑุจุฑุงู: <%= errorMessage || 'ูุทูุงู ุฏูุจุงุฑู ุชูุงุด ฺฉูุฏ' %>
  </div>
<% } else { %>

  <!-- ุฌุฏูู ฺฉุงุฑุจุฑุงู -->
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">ูุณุช ฺฉุงุฑุจุฑุงู</h3>
      <div>
        <span><%= totalUsers.toLocaleString() %> ฺฉุงุฑุจุฑ ุงูุช ุดุฏ</span>
      </div>
    </div>
    
    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th>ูุงู ฺฉุงุฑุจุฑ</th>
            <th>ุดูุงุณู</th>
            <th>ููุฌูุฏ ฺฉู ูพูู</th>
            <th>ููุฌูุฏ ุจุงูฺฉ</th>
            <th>ุณุทุญ</th>
            <th>ูุถุนุช</th>
            <th>ุชุงุฑุฎ ุนุถูุช</th>
            <th>ุนููุงุช</th>
          </tr>
        </thead>
        <tbody>
          <% if (users && users.length > 0) { %>
            <% users.forEach(user => { %>
              <tr>
                <td><%= user.username %></td>
                <td><small class="text-muted"><%= user.userId %></small></td>
                <td><%= user.wallet.toLocaleString() %> ๐ฐ</td>
                <td><%= user.bank.toLocaleString() %> ๐ฆ</td>
                <td><%= user.level || 0 %> <small class="text-muted">(<%= user.xp || 0 %> XP)</small></td>
                <td>
                  <% if (user.isBanned) { %>
                    <span class="badge badge-red">ูุณุฏูุฏ</span>
                  <% } else { %>
                    <span class="badge badge-green">ูุนุงู</span>
                  <% } %>
                </td>
                <td><%= user.joinDate ? new Date(user.joinDate).toLocaleDateString('fa-IR') : 'ูุงูุดุฎุต' %></td>
                <td>
                  <a href="/admin/users/<%= user.userId %>" class="btn btn-sm">
                    <i class="fas fa-eye"></i>
                  </a>
                  <a href="/admin/users/<%= user.userId %>/edit" class="btn btn-sm">
                    <i class="fas fa-edit"></i>
                  </a>
                  <% if (user.isBanned) { %>
                    <a href="/admin/users/<%= user.userId %>/unban" class="btn btn-sm" data-confirm="ุขุง ุงุฒ ุฑูุน ูุณุฏูุฏุช ุงู ฺฉุงุฑุจุฑ ุงุทููุงู ุฏุงุฑุฏุ">
                      <i class="fas fa-unlock"></i>
                    </a>
                  <% } else { %>
                    <a href="/admin/users/<%= user.userId %>/ban" class="btn btn-sm btn-danger" data-confirm="ุขุง ุงุฒ ูุณุฏูุฏ ฺฉุฑุฏู ุงู ฺฉุงุฑุจุฑ ุงุทููุงู ุฏุงุฑุฏุ">
                      <i class="fas fa-ban"></i>
                    </a>
                  <% } %>
                </td>
              </tr>
            <% }); %>
          <% } else { %>
            <tr>
              <td colspan="8" class="text-center">ูฺ ฺฉุงุฑุจุฑ ุงูุช ูุดุฏ</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
    
    <!-- ูพุฌูุดู -->
    <% if (totalPages > 1) { %>
      <div class="card-footer">
        <ul class="pagination">
          <% if (currentPage > 1) { %>
            <li>
              <a href="/admin/users?page=1<%= queryString ? '&' + queryString : '' %>" title="ุตูุญู ุงูู">
                <i class="fas fa-angle-double-right"></i>
              </a>
            </li>
            <li>
              <a href="/admin/users?page=<%= currentPage - 1 %><%= queryString ? '&' + queryString : '' %>" title="ุตูุญู ูุจู">
                <i class="fas fa-angle-right"></i>
              </a>
            </li>
          <% } %>
          
          <% 
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            
            if (endPage - startPage < 4) {
              startPage = Math.max(1, endPage - 4);
            }
          %>
          
          <% for (let i = startPage; i <= endPage; i++) { %>
            <li class="<%= i === currentPage ? 'active' : '' %>">
              <a href="/admin/users?page=<%= i %><%= queryString ? '&' + queryString : '' %>"><%= i %></a>
            </li>
          <% } %>
          
          <% if (currentPage < totalPages) { %>
            <li>
              <a href="/admin/users?page=<%= currentPage + 1 %><%= queryString ? '&' + queryString : '' %>" title="ุตูุญู ุจุนุฏ">
                <i class="fas fa-angle-left"></i>
              </a>
            </li>
            <li>
              <a href="/admin/users?page=<%= totalPages %><%= queryString ? '&' + queryString : '' %>" title="ุตูุญู ุขุฎุฑ">
                <i class="fas fa-angle-double-left"></i>
              </a>
            </li>
          <% } %>
        </ul>
      </div>
    <% } %>
  </div>
<% } %>