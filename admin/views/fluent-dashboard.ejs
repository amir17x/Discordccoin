<div class="fluent-content-body fluent-dashboard-page">
    <h1 class="fluent-page-title">داشبورد</h1>
    
    <!-- خلاصه آمار -->
    <div class="fluent-dashboard-summary">
        <!-- تعداد کاربران -->
        <div class="fluent-card fluent-stat-card">
            <div class="fluent-stat-card-content">
                <div class="fluent-stat-card-icon fluent-bg-primary-lighter">
                    <i class="fa-solid fa-users"></i>
                </div>
                <div class="fluent-stat-card-info">
                    <div class="fluent-stat-card-title">کاربران</div>
                    <div class="fluent-stat-card-value">
                        <%= stats.totalUsers.toLocaleString('fa-IR') %>
                        <% if (stats.userGrowth > 0) { %>
                            <span class="fluent-stat-card-change fluent-stat-card-change-up">
                                <i class="fa-solid fa-arrow-up"></i>
                                <%= stats.userGrowth.toLocaleString('fa-IR') %>%
                            </span>
                        <% } else if (stats.userGrowth < 0) { %>
                            <span class="fluent-stat-card-change fluent-stat-card-change-down">
                                <i class="fa-solid fa-arrow-down"></i>
                                <%= Math.abs(stats.userGrowth).toLocaleString('fa-IR') %>%
                            </span>
                        <% } else { %>
                            <span class="fluent-stat-card-change fluent-stat-card-change-neutral">
                                <i class="fa-solid fa-minus"></i>
                                0%
                            </span>
                        <% } %>
                    </div>
                    <div class="fluent-stat-card-subtitle">نسبت به ماه گذشته</div>
                </div>
            </div>
        </div>
        
        <!-- تعداد سرورها -->
        <div class="fluent-card fluent-stat-card">
            <div class="fluent-stat-card-content">
                <div class="fluent-stat-card-icon fluent-bg-info-lighter">
                    <i class="fa-solid fa-server"></i>
                </div>
                <div class="fluent-stat-card-info">
                    <div class="fluent-stat-card-title">سرورها</div>
                    <div class="fluent-stat-card-value">
                        <%= stats.totalServers.toLocaleString('fa-IR') %>
                        <% if (stats.serverGrowth > 0) { %>
                            <span class="fluent-stat-card-change fluent-stat-card-change-up">
                                <i class="fa-solid fa-arrow-up"></i>
                                <%= stats.serverGrowth.toLocaleString('fa-IR') %>%
                            </span>
                        <% } else if (stats.serverGrowth < 0) { %>
                            <span class="fluent-stat-card-change fluent-stat-card-change-down">
                                <i class="fa-solid fa-arrow-down"></i>
                                <%= Math.abs(stats.serverGrowth).toLocaleString('fa-IR') %>%
                            </span>
                        <% } else { %>
                            <span class="fluent-stat-card-change fluent-stat-card-change-neutral">
                                <i class="fa-solid fa-minus"></i>
                                0%
                            </span>
                        <% } %>
                    </div>
                    <div class="fluent-stat-card-subtitle">نسبت به ماه گذشته</div>
                </div>
            </div>
        </div>
        
        <!-- تراکنش‌ها -->
        <div class="fluent-card fluent-stat-card">
            <div class="fluent-stat-card-content">
                <div class="fluent-stat-card-icon fluent-bg-success-lighter">
                    <i class="fa-solid fa-money-bill-transfer"></i>
                </div>
                <div class="fluent-stat-card-info">
                    <div class="fluent-stat-card-title">تراکنش‌ها</div>
                    <div class="fluent-stat-card-value">
                        <%= stats.totalTransactions.toLocaleString('fa-IR') %>
                        <% if (stats.transactionGrowth > 0) { %>
                            <span class="fluent-stat-card-change fluent-stat-card-change-up">
                                <i class="fa-solid fa-arrow-up"></i>
                                <%= stats.transactionGrowth.toLocaleString('fa-IR') %>%
                            </span>
                        <% } else if (stats.transactionGrowth < 0) { %>
                            <span class="fluent-stat-card-change fluent-stat-card-change-down">
                                <i class="fa-solid fa-arrow-down"></i>
                                <%= Math.abs(stats.transactionGrowth).toLocaleString('fa-IR') %>%
                            </span>
                        <% } else { %>
                            <span class="fluent-stat-card-change fluent-stat-card-change-neutral">
                                <i class="fa-solid fa-minus"></i>
                                0%
                            </span>
                        <% } %>
                    </div>
                    <div class="fluent-stat-card-subtitle">نسبت به ماه گذشته</div>
                </div>
            </div>
        </div>
        
        <!-- بازی‌ها -->
        <div class="fluent-card fluent-stat-card">
            <div class="fluent-stat-card-content">
                <div class="fluent-stat-card-icon fluent-bg-warning-lighter">
                    <i class="fa-solid fa-gamepad"></i>
                </div>
                <div class="fluent-stat-card-info">
                    <div class="fluent-stat-card-title">بازی‌ها</div>
                    <div class="fluent-stat-card-value">
                        <%= stats.totalGames.toLocaleString('fa-IR') %>
                        <% if (stats.gameGrowth > 0) { %>
                            <span class="fluent-stat-card-change fluent-stat-card-change-up">
                                <i class="fa-solid fa-arrow-up"></i>
                                <%= stats.gameGrowth.toLocaleString('fa-IR') %>%
                            </span>
                        <% } else if (stats.gameGrowth < 0) { %>
                            <span class="fluent-stat-card-change fluent-stat-card-change-down">
                                <i class="fa-solid fa-arrow-down"></i>
                                <%= Math.abs(stats.gameGrowth).toLocaleString('fa-IR') %>%
                            </span>
                        <% } else { %>
                            <span class="fluent-stat-card-change fluent-stat-card-change-neutral">
                                <i class="fa-solid fa-minus"></i>
                                0%
                            </span>
                        <% } %>
                    </div>
                    <div class="fluent-stat-card-subtitle">نسبت به ماه گذشته</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- نمودارها -->
    <div class="fluent-dashboard-charts-container">
        <!-- نمودار رشد کاربران -->
        <div class="fluent-card fluent-chart-card">
            <div class="fluent-card-header">
                <h2 class="fluent-card-title">رشد کاربران</h2>
                <div class="fluent-card-header-actions">
                    <button type="button" class="fluent-icon-button" data-tooltip="به‌روزرسانی">
                        <i class="fa-solid fa-sync-alt"></i>
                    </button>
                    <button type="button" class="fluent-icon-button" data-tooltip="فیلترها">
                        <i class="fa-solid fa-filter"></i>
                    </button>
                </div>
            </div>
            <div class="fluent-card-content">
                <div class="fluent-chart-container" id="usersChart" data-auto-height="true">
                    <!-- نمودار اینجا رندر می‌شود -->
                </div>
                <div class="fluent-chart-legend">
                    <div class="fluent-chart-legend-item">
                        <span class="fluent-chart-legend-color" style="background-color: #0078d4;"></span>
                        <span>کاربران جدید</span>
                    </div>
                    <div class="fluent-chart-legend-item">
                        <span class="fluent-chart-legend-color" style="background-color: #c7e0f4;"></span>
                        <span>کاربران فعال</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- نمودار فعالیت‌های اقتصادی -->
        <div class="fluent-card fluent-chart-card">
            <div class="fluent-card-header">
                <h2 class="fluent-card-title">فعالیت‌های اقتصادی</h2>
                <div class="fluent-card-header-actions">
                    <button type="button" class="fluent-icon-button" data-tooltip="به‌روزرسانی">
                        <i class="fa-solid fa-sync-alt"></i>
                    </button>
                    <button type="button" class="fluent-icon-button" data-tooltip="فیلترها">
                        <i class="fa-solid fa-filter"></i>
                    </button>
                </div>
            </div>
            <div class="fluent-card-content">
                <div class="fluent-chart-container" id="economyChart" data-auto-height="true">
                    <!-- نمودار اینجا رندر می‌شود -->
                </div>
                <div class="fluent-chart-legend">
                    <div class="fluent-chart-legend-item">
                        <span class="fluent-chart-legend-color" style="background-color: #107c10;"></span>
                        <span>درآمد</span>
                    </div>
                    <div class="fluent-chart-legend-item">
                        <span class="fluent-chart-legend-color" style="background-color: #d13438;"></span>
                        <span>هزینه</span>
                    </div>
                    <div class="fluent-chart-legend-item">
                        <span class="fluent-chart-legend-color" style="background-color: #ffaa44;"></span>
                        <span>سود</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- لیست‌ها -->
    <div class="fluent-dashboard-lists-container">
        <!-- کاربران فعال اخیر -->
        <div class="fluent-card">
            <div class="fluent-card-header">
                <h2 class="fluent-card-title">کاربران فعال اخیر</h2>
                <div class="fluent-card-header-actions">
                    <a href="/admin/users" class="fluent-button fluent-button-secondary small">
                        مشاهده همه
                    </a>
                </div>
            </div>
            <div class="fluent-card-content">
                <div class="fluent-table-container">
                    <table class="fluent-table">
                        <thead>
                            <tr>
                                <th>کاربر</th>
                                <th>آخرین فعالیت</th>
                                <th>وضعیت</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% stats.recentActiveUsers.forEach(user => { %>
                                <tr data-href="/admin/users/<%= user.id %>">
                                    <td>
                                        <div class="fluent-user-row">
                                            <div class="fluent-avatar">
                                                <% if (user.avatar) { %>
                                                    <img src="<%= user.avatar %>" alt="<%= user.username %>" />
                                                <% } else { %>
                                                    <%= user.username.charAt(0).toUpperCase() %>
                                                <% } %>
                                            </div>
                                            <div>
                                                <div><%= user.username %></div>
                                                <div style="font-size: 12px; color: var(--text-secondary);"><%= user.userID %></div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <%= new Date(user.lastActive).toLocaleDateString('fa-IR') %>
                                        <div style="font-size: 12px; color: var(--text-secondary);">
                                            <%= new Date(user.lastActive).toLocaleTimeString('fa-IR') %>
                                        </div>
                                    </td>
                                    <td>
                                        <% if (user.status === 'online') { %>
                                            <span class="fluent-badge success">آنلاین</span>
                                        <% } else if (user.status === 'away') { %>
                                            <span class="fluent-badge warning">غایب</span>
                                        <% } else { %>
                                            <span class="fluent-badge neutral">آفلاین</span>
                                        <% } %>
                                    </td>
                                </tr>
                            <% }); %>
                            
                            <% if (stats.recentActiveUsers.length === 0) { %>
                                <tr>
                                    <td colspan="3" class="text-center">کاربر فعالی یافت نشد</td>
                                </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- آخرین رویدادها -->
        <div class="fluent-card">
            <div class="fluent-card-header">
                <h2 class="fluent-card-title">آخرین رویدادها</h2>
                <div class="fluent-card-header-actions">
                    <a href="/admin/events" class="fluent-button fluent-button-secondary small">
                        مشاهده همه
                    </a>
                </div>
            </div>
            <div class="fluent-card-content">
                <div class="fluent-events-list">
                    <% stats.recentEvents.forEach(event => { %>
                        <div class="fluent-event-item">
                            <div class="fluent-event-icon">
                                <% if (event.type === 'user') { %>
                                    <i class="fa-solid fa-user"></i>
                                <% } else if (event.type === 'server') { %>
                                    <i class="fa-solid fa-server"></i>
                                <% } else if (event.type === 'economy') { %>
                                    <i class="fa-solid fa-money-bill"></i>
                                <% } else if (event.type === 'game') { %>
                                    <i class="fa-solid fa-gamepad"></i>
                                <% } else { %>
                                    <i class="fa-solid fa-bell"></i>
                                <% } %>
                            </div>
                            <div class="fluent-event-content">
                                <div class="fluent-event-title"><%= event.title %></div>
                                <div class="fluent-event-description"><%= event.description %></div>
                                <div class="fluent-event-meta">
                                    <div class="fluent-event-date">
                                        <i class="fa-solid fa-calendar"></i>
                                        <%= new Date(event.date).toLocaleDateString('fa-IR') %>
                                        <%= new Date(event.date).toLocaleTimeString('fa-IR') %>
                                    </div>
                                    <div class="fluent-event-status">
                                        <i class="fa-solid fa-circle"></i>
                                        <%= event.status %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                    
                    <% if (stats.recentEvents.length === 0) { %>
                        <div class="fluent-empty-state">
                            <i class="fa-solid fa-calendar-xmark"></i>
                            <p>رویدادی یافت نشد</p>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- اسکریپت‌های مربوط به نمودارها -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // نمودار رشد کاربران
        const usersCtx = document.getElementById('usersChart').getContext('2d');
        const usersLabels = <%= JSON.stringify(stats.userChartLabels) %>;
        const usersData = <%= JSON.stringify(stats.userChartData) %>;
        
        new Chart(usersCtx, {
            type: 'line',
            data: {
                labels: usersLabels,
                datasets: [
                    {
                        label: 'کاربران جدید',
                        data: usersData.newUsers,
                        borderColor: '#0078d4',
                        backgroundColor: 'rgba(0, 120, 212, 0.1)',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'کاربران فعال',
                        data: usersData.activeUsers,
                        borderColor: '#83beec',
                        backgroundColor: 'rgba(131, 190, 236, 0.1)',
                        tension: 0.3,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        rtl: true,
                        titleFont: {
                            family: 'Vazirmatn'
                        },
                        bodyFont: {
                            family: 'Vazirmatn'
                        },
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += context.parsed.y.toLocaleString('fa-IR');
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            font: {
                                family: 'Vazirmatn'
                            }
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            font: {
                                family: 'Vazirmatn'
                            },
                            callback: function(value) {
                                return value.toLocaleString('fa-IR');
                            }
                        }
                    }
                }
            }
        });
        
        // نمودار فعالیت‌های اقتصادی
        const economyCtx = document.getElementById('economyChart').getContext('2d');
        const economyLabels = <%= JSON.stringify(stats.economyChartLabels) %>;
        const economyData = <%= JSON.stringify(stats.economyChartData) %>;
        
        new Chart(economyCtx, {
            type: 'bar',
            data: {
                labels: economyLabels,
                datasets: [
                    {
                        label: 'درآمد',
                        data: economyData.income,
                        backgroundColor: 'rgba(16, 124, 16, 0.8)',
                    },
                    {
                        label: 'هزینه',
                        data: economyData.expense,
                        backgroundColor: 'rgba(209, 52, 56, 0.8)',
                    },
                    {
                        label: 'سود',
                        data: economyData.profit,
                        backgroundColor: 'rgba(255, 170, 68, 0.8)',
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        rtl: true,
                        titleFont: {
                            family: 'Vazirmatn'
                        },
                        bodyFont: {
                            family: 'Vazirmatn'
                        },
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += context.parsed.y.toLocaleString('fa-IR') + ' CCOIN';
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            font: {
                                family: 'Vazirmatn'
                            }
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            font: {
                                family: 'Vazirmatn'
                            },
                            callback: function(value) {
                                return value.toLocaleString('fa-IR');
                            }
                        }
                    }
                }
            }
        });
    });
</script>
